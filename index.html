<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal de Trading A.M.E.D</title>

    <!-- Tailwind CSS via jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css?v=1.1" rel="stylesheet">

    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-dark: #131722;
            --bg-light: #1e222d;
            --border-color: #2a2e39;
            --text-primary: #d1d4dc;
            --text-secondary: #8a91a0;
            --accent-blue: #FF5722;
            --accent-green: #26a69a;
            --accent-red: #ef5350;
            --accent-yellow: #FFD700;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }

        .bg-bg-dark {
            background-color: var(--bg-dark);
        }

        .bg-bg-light {
            background-color: var(--bg-light);
        }

        .border-border-color {
            border-color: var(--border-color);
        }

        .text-text-primary {
            color: var(--text-primary);
        }

        .text-text-secondary {
            color: var(--text-secondary);
        }

        .text-accent-blue {
            color: var(--accent-blue);
        }

        .text-accent-green {
            color: var(--accent-green);
        }

        .text-accent-red {
            color: var(--accent-red);
        }

        .text-accent-yellow {
            color: var(--accent-yellow);
        }

        .bg-accent-blue {
            background-color: var(--accent-blue);
        }

        .bg-accent-green {
            background-color: var(--accent-green);
        }

        .bg-accent-red {
            background-color: var(--accent-red);
        }

        .bg-accent-yellow {
            background-color: var(--accent-yellow);
        }

        .border-accent-blue {
            border-color: var(--accent-blue);
        }

        .hover\:bg-accent-blue:hover {
            background-color: var(--accent-blue);
        }

        .hover\:text-accent-blue:hover {
            color: var(--accent-blue);
        }

        .focus\:ring-accent-blue:focus {
            --tw-ring-color: var(--accent-blue);
        }

        /* Styles personnalisés pour l'interface */
        .calendar-day {
            transition: all 0.2s ease;
            min-height: 80px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(255, 87, 34, 0.2);
        }

        .indicators-container {
            position: absolute;
            right: 0.3rem;
            top: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 0.2rem 0;
        }

        .indicator {
            font-size: 0.8rem;
            line-height: 1;
        }

        .indicator.note-indicator {
            color: var(--accent-yellow);
        }

        .indicator.daily-indicator {
            color: var(--accent-blue);
        }

        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            background: linear-gradient(145deg, #1a1f2b, #232936);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .modern-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23FF5722' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }

        .auto-resize {
            resize: vertical;
            overflow: hidden;
            min-height: 100px;
        }

        /* Styles pour le calendrier */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        /* Styles pour les formulaires */
        .form-input {
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        .form-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: var(--bg-dark);
            border: none;
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        /* Styles pour les boutons */
        .btn-primary {
            background-color: var(--accent-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: #e64a19;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background-color: var(--accent-blue);
            color: white;
        }

        /* Styles pour les listes */
        .todo-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--bg-dark);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--bg-dark);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        /* Styles pour les images preview */
        .image-preview {
            margin-top: 0.75rem;
            border-radius: 0.5rem;
            overflow: hidden;
            max-width: 100%;
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
        }

        /* Styles pour les notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background-color: var(--accent-green);
        }

        .notification.error {
            background-color: var(--accent-red);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .calendar-grid {
                gap: 0.125rem;
            }

            .calendar-day {
                min-height: 60px;
                font-size: 0.875rem;
            }
        }

        /* Media query for screens between 769px and 1023px (typical for smaller laptops) */
        @media (min-width: 769px) and (max-width: 1023px) {
            .calendar-day {
                min-height: 55px; /* Further adjusted for better fit on medium screens */
            }
        }

        /* Styles pour la colonne des résultats hebdomadaires */
        .weekly-summary-card {
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem; /* 8px */
            padding: 0.75rem; /* 12px */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.25rem; /* 4px */
        }

        .week-title {
            font-size: 0.875rem; /* 14px */
            color: var(--text-secondary);
            font-weight: 500;
        }

        .week-pnl {
            font-size: 1.25rem; /* 20px */
            font-weight: 700; /* bold */
            line-height: 1.2;
        }

        .week-days {
            font-size: 0.75rem; /* 12px */
            color: var(--text-secondary);
        }

        .profit-color {
            color: var(--accent-green);
        }

        .loss-color {
            color: var(--accent-red);
        }

        .neutral-color {
            color: var(--text-primary);
        }
    </style>
</head>

<body class="min-h-screen leading-relaxed">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <header class="bg-bg-light rounded-xl p-6 mb-8 border border-border-color shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1
                        class="text-3xl font-bold text-accent-blue font-montserrat flex items-center justify-center md:justify-start">
                        <i class="fas fa-chart-bar mr-2"></i>
                        Journal de Trading A.M.E.D
                    </h1>
                    <p class="text-text-secondary mt-2 font-montserrat">Enregistrez et analysez vos trades selon les
                        cycles Intraday</p>
                </div>
                <nav>
                    <button id="help-btn" class="btn-primary flex items-center">
                        <i class="fas fa-question-circle mr-2"></i>
                        Aide
                    </button>
                </nav>
            </div>
        </header>

        <!-- Section d'aide -->
        <div id="help-section" class="hidden mb-8 bg-bg-light rounded-xl border border-border-color shadow-lg p-6">
            <h2 class="text-xl font-bold text-accent-blue mb-4 flex items-center">
                <i class="fas fa-info-circle mr-2"></i>
                Aide & Introduction
            </h2>
            <p class="mb-4">Bienvenue dans le Journal de Trading AMED. Cette application vous permet d'enregistrer,
                d'analyser et de suivre vos opérations de trading selon différents cycles (Intraday, Hebdomadaire,
                etc.).</p>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-bg-dark p-4 rounded-lg">
                    <h3 class="font-bold text-accent-blue mb-2 flex items-center">
                        <i class="fas fa-calendar mr-2"></i>
                        Calendrier
                    </h3>
                    <p>Cliquez sur un jour pour ajouter ou consulter une entrée de journal pour cette date. Les jours
                        avec des entrées sont marqués d'un point orange.</p>
                </div>

                <div class="bg-bg-dark p-4 rounded-lg">
                    <h3 class="font-bold text-accent-blue mb-2 flex items-center">
                        <i class="fas fa-folder mr-2"></i>
                        Onglets
                    </h3>
                    <ul class="list-disc pl-5 space-y-1">
                        <li><strong>Daily</strong>: Observations et tendances du jour</li>
                        <li><strong>Trade</strong>: Détails d'un trade</li>
                        <li><strong>Weekly</strong>: Analyse hebdomadaire</li>
                        <li><strong>Notes</strong>: Pense-bêtes et événements</li>
                        <li><strong>Calculatrice</strong>: Calculs de risque</li>
                    </ul>
                </div>
            </div>

            <div class="mt-6">
                <p class="text-text-secondary">Cliquez à nouveau sur le bouton "Aide" pour masquer cette section.</p>
            </div>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-1 gap-8">
            <!-- Calendrier et Résultats Hebdo Section -->
            <section class="bg-bg-light p-6 rounded-xl border border-border-color shadow-lg mb-8">
                <!-- Header du Calendrier -->
                <div class="flex justify-between items-center mb-6">
                    <button id="prevMonth"
                        class="text-accent-blue hover:text-orange-300 p-2 rounded-full hover:bg-bg-dark transition">
                        <i class="fas fa-chevron-left text-xl"></i>
                    </button>
                    <h2 id="currentMonthYear" class="text-xl font-bold text-center"></h2>
                    <button id="nextMonth"
                        class="text-accent-blue hover:text-orange-300 p-2 rounded-full hover:bg-bg-dark transition">
                        <i class="fas fa-chevron-right text-xl"></i>
                    </button>
                </div>

                <!-- Grille Principale (Calendrier + Résultats) -->
                <div id="calendar-container" class="grid" style="grid-template-columns: repeat(7, 1fr) auto; gap: 0.5rem;">
                    <!-- Headers de la grille (Lun-Dim + Hebdo) -->
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Lun</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Mar</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Mer</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Jeu</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Ven</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Sam</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Dim</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Résultats Hebdo</div>

                    <!-- Le contenu du calendrier (jours) et les résultats hebdo seront injectés ici par JS -->
                </div>
            </section>

            <!-- Conseil du jour -->
            <section id="daily-tip-section"
                class="bg-bg-light p-6 rounded-xl border border-border-color shadow-lg mb-8">
                <h3 class="font-bold text-accent-blue mb-3 flex items-center">
                    <i class="fas fa-lightbulb mr-2"></i>
                    Conseil du jour
                </h3>
                <p class="text-sm text-center">La patience est la clé. Attendez que votre setup se présente, ne le forcez pas.</p>
            </section>

            <!-- Formulaire Section -->
            <section id="form-section"
                class="hidden bg-bg-light p-6 rounded-xl border border-border-color shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Nouvelle Entrée pour le <span id="entry-date"
                            class="text-accent-blue"></span></h2>
                    <button id="close-form" class="text-text-secondary hover:text-accent-blue text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Tabs Navigation -->
                <div class="flex flex-wrap mb-6 border-b border-border-color">
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-accent-blue text-white flex items-center border border-accent-blue"
                        data-tab="daily">
                        <i class="fas fa-sun mr-2"></i>
                        Daily
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="trade">
                        <i class="fas fa-dollar-sign mr-2"></i>
                        Trade
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="weekly">
                        <i class="fas fa-calendar-week mr-2"></i>
                        Weekly
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="notes">
                        <i class="fas fa-sticky-note mr-2"></i>
                        Notes
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="calculator">
                        <i class="fas fa-calculator mr-2"></i>
                        Calculatrice
                    </button>
                </div>

                <form id="journal-form" class="space-y-6">
                    <!-- Daily Tab -->
                    <div id="daily-tab" class="tab-content block">
                        <div class="space-y-4">
                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Tendance du PDR
                                    (Previous Day Range)</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">PDR</label>
                                        <select class="form-select modern-select w-1/2">
                                            <option value="bullish">Bullish</option>
                                            <option value="bearish">Bearish</option>
                                            <option value="consolidation">Consolidation</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Capture H1 (URL)</label>
                                        <input type="url" class="form-input w-full" placeholder="https://...">
                                        <div class="image-preview hidden">
                                            <img src="" alt="Preview">
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-text-secondary mb-2">Observations</label>
                                    <textarea class="form-input w-full auto-resize"
                                        placeholder="Ex: Attente d'un retour sur le FVG..."></textarea>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C1</h3>
                                    <label class="block text-text-secondary mb-2">Phase C1</label>
                                    <select class="form-select modern-select w-1/2">
                                        <option value="accumulation">Accumulation</option>
                                        <option value="re-accumulation">Ré-Accumulation</option>
                                        <option value="distribution">Distribution</option>
                                        <option value="re-distribution">Re-Distribution</option>
                                        <option value="continuation">Continuation</option>
                                        <option value="reversal">Renversement</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Capture C1 (URL)</label>
                                        <input type="url" class="form-input w-full" placeholder="https://...">
                                        <div class="image-preview hidden">
                                            <img src="" alt="Preview">
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C2</h3>
                                    <label class="block text-text-secondary mb-2">Phase C2</label>
                                    <select class="form-select modern-select w-1/2">
                                        <option value="accumulation">Accumulation</option>
                                        <option value="re-accumulation">Ré-Accumulation</option>
                                        <option value="distribution">Distribution</option>
                                        <option value="re-distribution">Re-Distribution</option>
                                        <option value="continuation">Continuation</option>
                                        <option value="reversal">Renversement</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Capture C2 (URL)</label>
                                        <input type="url" class="form-input w-full" placeholder="https://...">
                                        <div class="image-preview hidden">
                                            <img src="" alt="Preview">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C3 & Setup
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">Type de Setup</label>
                                        <select class="form-select modern-select w-1/2">
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Manipulation</label>
                                        <select class="form-select modern-select w-1/2">
                                            <option value="">-- Sélectionner --</option>
                                            <option value="bullish_shorts">Bullish (for Shorts)</option>
                                            <option value="bearish_longs">Bearish (for Longs)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">Swing Point balayé</label>
                                        <input type="text" class="form-input w-full"
                                            placeholder="Ex: PDL, PWH, Swing Low M15">
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Capture Setup (URL)</label>
                                        <input type="url" class="form-input w-full" placeholder="https://...">
                                        <div class="image-preview hidden">
                                            <img src="" alt="Preview">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trade Tab -->
                    <div id="trade-tab" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-text-secondary mb-2">Actif</label>
                                <select id="asset-select" class="form-select modern-select w-full">
                                    <option value="">- Sélectionner -</option>
                                    <option value="EUR/USD" data-tick="0.0001">EUR/USD</option>
                                    <option value="GBP/USD" data-tick="0.0001">GBP/USD</option>
                                    <option value="MNQ" data-tick="0.25">MNQ</option>
                                    <option value="NQ" data-tick="0.25">NQ</option>
                                    <option value="US100" data-tick="0.01">US100</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">$/Tick - $/Pip</label>
                                <input type="text" id="tick-value" readonly class="form-input w-full opacity-70">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Taille de position</label>
                                <input type="number" id="position-size" class="form-input w-full" min="0.01" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Stop Loss</label>
                                <input type="number" id="stop-loss" class="form-input w-full" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Take Profit</label>
                                <input type="number" id="take-profit" class="form-input w-full" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Résultat</label>
                                <select id="result-select" class="form-select modern-select w-full">
                                    <option value="">- Sélectionner -</option>
                                    <option value="win">Gagnant</option>
                                    <option value="loss">Perdant</option>
                                    <option value="breakeven">Breakeven</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">P&L</label>
                                <input type="text" id="pnl-result" readonly class="form-input w-full">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Ratio R/R (TP/SL)</label>
                                <input type="text" id="rr-result" readonly class="form-input w-full">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-text-secondary mb-2">Revue du Trade</label>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Ai-je respecté le plan ? Leçons..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Tab -->
                    <div id="weekly-tab" class="tab-content hidden">
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Tendance du PWR
                                (Previous Week Range)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-text-secondary mb-2">PWR</label>
                                    <select class="form-select modern-select w-1/2">
                                        <option value="bullish">Bullish</option>
                                        <option value="bearish">Bearish</option>
                                        <option value="consolidation">Consolidation</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Semaine #</label>
                                        <input type="text" id="week-number" class="form-input w-full" readonly>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-text-secondary mb-2">Capture H4 (URL)</label>
                                    <input type="url" class="form-input w-full" placeholder="https://...">
                                    <div class="image-preview hidden">
                                        <img src="" alt="Preview">
                                    </div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Obs/Notes</label>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Observations et notes..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Tab -->
                    <div id="notes-tab" class="tab-content hidden">
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Notes Générales /
                                    Pense-bêtes</h3>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Écrivez vos notes générales ici..."></textarea>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Liste de Tâches
                                    (To-Do)</h3>
                                <div class="flex gap-2 mb-4">
                                    <input type="text" id="todo-input" class="form-input w-9/12"
                                        placeholder="Nouvelle tâche...">
                                    <select id="todo-priority" class="form-select modern-select w-2/12">
                                        <option value="1">⭐</option>
                                        <option value="2">⭐⭐</option>
                                        <option value="3">⭐⭐⭐</option>
                                    </select>
                                    <button type="button" id="add-todo" class="btn-primary">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <ul id="todoList" class="space-y-2"></ul>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Événements
                                    Économiques Importants</h3>
                                <div class="flex gap-2 mb-4">
                                    <input type="time" id="event-time" class="form-input">
                                    <input type="text" id="event-desc" class="form-input flex-grow"
                                        placeholder="Description de l'événement...">
                                    <button type="button" id="add-event" class="btn-primary">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <ul id="eventList" class="space-y-2"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Calculator Tab -->
                    <div id="calculator-tab" class="tab-content hidden">
                        <div class="bg-bg-light rounded-xl border border-border-color overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-text-primary mb-4">Calculatrice de Risque</h2>
                                <div class="grid grid-cols-2 gap-3 mb-6">
                                    <button class="ticker-btn btn-secondary" data-ticker="NQ">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        NQ
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="MNQ">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        MNQ
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="GU">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        GU & EU
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="US100">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        US100
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1">Capital
                                            ($)</label>
                                        <input type="number" id="calc-capital" class="form-input w-full"
                                            placeholder="10000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1">Risk
                                            (%)</label>
                                        <input type="number" id="calc-risk" class="form-input w-full" placeholder="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1" id="calc-sl-label">Stop Loss
                                            (ticks)</label>
                                        <input type="number" id="calc-sl" class="form-input w-full" placeholder="10">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1" id="calc-tp-label">Take Profit
                                            (ticks)</label>
                                        <input type="number" id="calc-tp" class="form-input w-full" placeholder="20">
                                    </div>
                                </div>

                                <button id="calculate-btn" class="btn-primary w-1/4 mx-auto block mb-6">
                                    <i class="fas fa-calculator mr-2"></i>
                                    Calculer
                                </button>

                                <div id="calc-results" class="hidden">
                                    <h2 class="text-lg font-semibold text-text-primary mb-4">Résultats pour <span
                                            id="selected-ticker" class="text-accent-blue">NQ</span></h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-balance-scale text-accent-blue mr-2"></i>
                                                <span class="font-medium text-text-primary">Risk/Reward</span>
                                            </div>
                                            <div id="rr-display" class="text-2xl font-bold text-accent-blue">1:2</div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-exclamation-triangle text-accent-red mr-2"></i>
                                                <span class="font-medium text-text-primary">Risk ($)</span>
                                            </div>
                                            <div id="risk-display" class="text-2xl font-bold text-accent-red">$100</div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-arrow-trend-up text-accent-green mr-2"></i>
                                                <span class="font-medium text-text-primary">Gain potentiel ($)</span>
                                            </div>
                                            <div id="gain-display" class="text-2xl font-bold text-accent-green">$200
                                            </div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-cubes text-blue-400 mr-2"></i>
                                                <span class="font-medium text-text-primary">Contrats max</span>
                                            </div>
                                            <div id="contracts-display" class="text-2xl font-bold text-blue-400">2</div>
                                        </div>
                                    </div>
                                    <div class="mt-4 text-sm text-text-secondary">
                                        <p id="ticker-info">NQ: $5 par tick (0.25 point) | $20 par point</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="pt-6 flex justify-between items-center">
                        <div class="flex gap-4">
                            <input type="file" id="importDataInput" accept="application/json" class="hidden" />
                            <button type="button" id="importDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-upload mr-2"></i>
                                Importer
                            </button>
                            <button type="button" id="exportDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-download mr-2"></i>
                                Sauvegarder
                            </button>
                            <button type="button" id="clearDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-eraser mr-2"></i>
                                Effacer
                            </button>
                        </div>
                        <div class="flex gap-4">
                            <button type="button" id="cancel-btn" class="btn-secondary">
                                <i class="fas fa-times mr-2"></i>
                                Annuler
                            </button>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Enregistrer
                            </button>
                        </div>
                    </div>
                </form>
            </section>
        </main>

        <footer class="text-center text-text-secondary py-6 mt-8">
            <div class="flex flex-col sm:flex-row justify-center items-center">
                <div class="flex items-center">
                    <i class="fas fa-code mr-2 text-accent-blue"></i>
                    Powered by 3drives - © 2025 - Thitix
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Application principale
        class TradingJournal {
            constructor() {
                this.currentDate = new Date();
                this.selectedDateForEntry = null;
                this.tradingTips = [
                    "La patience est la clé. Attendez que votre setup se présente, ne le forcez pas.",
                    "Ne risquez jamais plus que ce que vous êtes prêt à perdre sur un seul trade.",
                    "Le plan de trading est votre feuille de route. Suivez-le à la lettre.",
                    "L'analyse post-trade est plus importante que l'analyse pré-trade. Apprenez de vos erreurs et de vos succès.",
                    "Le marché est fractal. Les mêmes schémas se répètent sur toutes les unités de temps.",
                    "La gestion du risque est la seule chose que vous pouvez contrôler à 100%.",
                    "N'ayez pas peur de prendre une perte. C'est une partie inévitable du trading.",
                    "Un trade gagnant ne fait pas de vous un génie, un trade perdant ne fait pas de vous un échec. Restez humble.",
                    "La psychologie est 90% du jeu. Maîtrisez vos émotions.",
                    "Toujours commencer par analyser le contexte du marché avant d'entrer en position. Une analyse technique fiable doit être à la fois confirmée et comporter un niveau clair d'invalidation."
                ];
                this.tickerData = {
                    'NQ': { tickValue: 5, tickSize: 0.25, name: 'NASDAQ-100 E-mini' },
                    'MNQ': { tickValue: 0.5, tickSize: 0.25, name: 'Micro NASDAQ-100' },
                    'GU': { tickValue: 10, tickSize: 0.0001, name: 'GBP/USD & EUR/USD' }, // 1 pip = 0.0001, 1 pip value = 10$
                    'US100': { tickValue: 0.1, tickSize: 0.01, name: 'US Tech 100' } // 1 tick = 0.01 point, 1 tick value = 0.1$
                };
                this.selectedTicker = 'GU';
                this.init();
            }

            init() {
                this.initializeDOM();
                this.setupEventListeners();
                this.renderCalendar();
                this.showRandomTip();
                this.showNotification('Application chargée avec succès!', 'success');
            }

            showRandomTip() {
                const tipContainer = document.querySelector('#daily-tip-section p');
                if (tipContainer) {
                    const randomIndex = Math.floor(Math.random() * this.tradingTips.length);
                    tipContainer.textContent = this.tradingTips[randomIndex];
                }
            }

            initializeDOM() {
                // Éléments DOM principaux
                this.calendarContainer = document.getElementById('calendar-container');
                this.currentMonthYear = document.getElementById('currentMonthYear');
                this.formSection = document.getElementById('form-section');
                this.journalForm = document.getElementById('journal-form');
                this.entryDateEl = document.getElementById('entry-date');
                this.helpSection = document.getElementById('help-section');
                this.weekNumberInput = document.getElementById('week-number');
                this.dailyTip = document.getElementById('daily-tip-section');

                // Vérification des éléments critiques
                if (!this.calendarContainer || !this.currentMonthYear) {
                    console.error('Éléments critiques manquants dans le DOM');
                    this.showNotification('Erreur: Éléments critiques manquants', 'error');
                    return;
                }

                console.log('DOM initialisé avec succès');
            }

            setupEventListeners() {
                // Navigation du calendrier
                document.getElementById('prevMonth')?.addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('nextMonth')?.addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });

                // Boutons du formulaire
                document.getElementById('cancel-btn')?.addEventListener('click', () => {
                    this.hideEntryForm();
                });

                document.getElementById('close-form')?.addEventListener('click', () => {
                    this.hideEntryForm();
                });

                // Soumission du formulaire
                this.journalForm?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveEntry();
                });

                // Gestion des onglets
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', () => {
                        this.switchTab(button.getAttribute('data-tab'));
                    });
                });

                // Bouton aide
                document.getElementById('help-btn')?.addEventListener('click', () => {
                    this.helpSection.classList.toggle('hidden');
                });

                // Prévisualisation des images
                this.setupImagePreviews();

                // Auto-resize des textareas
                this.setupAutoResize();

                // Gestion des tâches et événements
                this.setupNotesHandlers();

                // Calculatrice de trade
                this.setupTradeCalculator();

                // Calculatrice de risque
                this.setupRiskCalculator();

                // Nouveaux boutons
                document.getElementById('importDataBtn')?.addEventListener('click', () => {
                    document.getElementById('importDataInput').click();
                });
                document.getElementById('importDataInput')?.addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                });
                document.getElementById('exportDataBtn')?.addEventListener('click', () => {
                    this.exportData();
                });
                document.getElementById('clearDataBtn')?.addEventListener('click', () => {
                    this.clearAllData();
                });
            }

            calculatePnl(tradeData) {
                if (!tradeData || !tradeData.result || tradeData.result === 'breakeven') return 0;

                const { asset, positionSize, stopLoss, takeProfit, result } = tradeData;
                if (!asset || !positionSize || !result) return 0;

                const ticker = this.tickerData[asset];
                if (!ticker) return 0;

                const posSize = parseFloat(positionSize);
                // Ensure takeProfit and stopLoss are valid numbers
                const tp = parseFloat(takeProfit);
                const sl = parseFloat(stopLoss);

                let pnl = 0;

                if (result === 'win' && !isNaN(tp)) { // Check if tp is a valid number
                    pnl = posSize * tp * ticker.tickValue;
                } else if (result === 'loss' && !isNaN(sl)) { // Check if sl is a valid number
                    pnl = -1 * posSize * sl * ticker.tickValue;
                }

                return pnl;
            }

            renderCalendar() {
                if (!this.calendarContainer || !this.currentMonthYear) {
                    console.error('Éléments du calendrier manquants');
                    return;
                }

                // Vider le conteneur en ne gardant que les en-têtes
                while (this.calendarContainer.children.length > 8) {
                    this.calendarContainer.removeChild(this.calendarContainer.lastChild);
                }

                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                this.currentMonthYear.textContent = new Date(year, month).toLocaleDateString('fr-FR', {
                    month: 'long',
                    year: 'numeric'
                });

                const firstDayOfMonth = new Date(year, month, 1);
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const startOffset = (firstDayOfMonth.getDay() + 6) % 7; // 0 = Lundi

                let currentWeekPnl = 0;
                let currentWeekDaysTraded = new Set();
                let weekCounter = 1;

                // 1. Jours du mois précédent
                const prevMonthDays = new Date(year, month, 0).getDate();
                for (let i = 0; i < startOffset; i++) {
                    const day = this.createCalendarDay({ day: prevMonthDays - startOffset + 1 + i, isOtherMonth: true });
                    this.calendarContainer.appendChild(day);
                }

                // 2. Jours du mois actuel
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayDate = new Date(year, month, i);
                    const dayOfWeek = (dayDate.getDay() + 6) % 7;

                    // Calcul du PnL pour le jour
                    const formattedDate = this.formatDate(dayDate);
                    const entryDataString = localStorage.getItem(`journal_entry_${formattedDate}`);
                    if (entryDataString) {
                        try {
                            const entryData = JSON.parse(entryDataString);
                            if (entryData.trade && entryData.trade.result) {
                                const pnl = this.calculatePnl(entryData.trade);
                                if (pnl !== 0 || entryData.trade.result === 'breakeven') {
                                    currentWeekPnl += pnl;
                                    currentWeekDaysTraded.add(i);
                                }
                            }
                        } catch (e) { console.error(`Erreur de parsing pour ${formattedDate}`, e); }
                    }

                    const day = this.createDayElement(dayDate);
                    this.calendarContainer.appendChild(day);

                    // Si c'est un dimanche (fin de semaine)
                    if (dayOfWeek === 6) {
                        this.appendWeeklySummaryCard(currentWeekPnl, currentWeekDaysTraded.size, weekCounter);
                        currentWeekPnl = 0;
                        currentWeekDaysTraded.clear();
                        weekCounter++;
                    } 
                    // Si c'est le dernier jour du mois (et pas un dimanche)
                    else if (i === daysInMonth) {
                        for (let j = dayOfWeek + 1; j < 7; j++) {
                            this.calendarContainer.appendChild(this.createCalendarDay({ isOtherMonth: true }));
                        }
                        this.appendWeeklySummaryCard(currentWeekPnl, currentWeekDaysTraded.size, weekCounter);
                        weekCounter++;
                    }
                }

                // 3. Remplir le reste de la grille pour avoir 6 semaines complètes
                const totalGridCells = 6 * 8; // 6 semaines * (7 jours + 1 carte)
                const currentCells = this.calendarContainer.children.length;
                const cellsToAdd = totalGridCells - currentCells;

                let nextMonthDay = 1;
                for(let i = 0; i < cellsToAdd; i++) {
                    const cellIndexInRow = (this.calendarContainer.children.length - 8) % 8;
                    if (cellIndexInRow < 7) {
                        this.calendarContainer.appendChild(this.createCalendarDay({ day: nextMonthDay++, isOtherMonth: true }));
                    } else {
                        this.appendWeeklySummaryCard(0, 0, weekCounter, true);
                        weekCounter++;
                    }
                }
                console.log('Calendrier rendu avec succès');
            }

            createDayElement(date) {
                const dayNumber = date.getDate();
                const isToday = this.formatDate(date) === this.formatDate(new Date());
                const day = this.createCalendarDay(dayNumber, false, isToday);

                const formattedDate = this.formatDate(date);
                const entryDataString = localStorage.getItem(`journal_entry_${formattedDate}`);
                if (entryDataString) {
                    try {
                        const entryData = JSON.parse(entryDataString);
                        const indicatorsContainer = document.createElement('div');
                        indicatorsContainer.className = 'indicators-container';

                        // 1. Trade Icon (Top)
                        const tradeResult = entryData?.trade?.result;
                        const tradeIndicator = document.createElement('span');
                        tradeIndicator.className = 'indicator trade-indicator';
                        if (tradeResult === 'win') {
                            tradeIndicator.textContent = '✅';
                            indicatorsContainer.appendChild(tradeIndicator);
                        } else if (tradeResult === 'loss') {
                            tradeIndicator.textContent = '❌';
                            indicatorsContainer.appendChild(tradeIndicator);
                        }

                        // 2. Daily Icon (Middle)
                        const dailyData = entryData?.daily;
                        const hasDailyEntry = dailyData && Object.values(dailyData).some(value => value !== '');
                        if (hasDailyEntry) {
                            const dailyIndicator = document.createElement('i');
                            dailyIndicator.className = 'fas fa-calendar-week indicator daily-indicator';
                            indicatorsContainer.appendChild(dailyIndicator);
                        }

                        // 3. Note Icon (Bottom)
                        const hasNoteEntry = entryData?.notes?.general?.trim() !== '' || (entryData?.notes?.todoList?.length > 0) || (entryData?.notes?.eventList?.length > 0);
                        if (hasNoteEntry) {
                            const noteIndicator = document.createElement('i');
                            noteIndicator.className = 'fas fa-sticky-note indicator note-indicator';
                            indicatorsContainer.appendChild(noteIndicator);
                        }

                        if (indicatorsContainer.hasChildNodes()) {
                            day.appendChild(indicatorsContainer);
                        }
                    } catch (e) {
                        console.error(`Failed to parse entry for ${formattedDate}`, e);
                    }
                }

                day.addEventListener('click', () => {
                    this.selectedDateForEntry = date;
                    this.showEntryForm(date);
                });

                return day;
            }

            appendWeeklySummaryCard(pnl, daysCount, weekNumber, isEmpty = false) {
                const card = document.createElement('div');
                
                if (isEmpty || daysCount === 0) {
                    card.className = 'weekly-summary-card opacity-50';
                    card.innerHTML = `<p class="week-title">Week ${weekNumber}</p><p class="week-pnl neutral-color">$0,00</p><p class="week-days">0 days</p>`;
                } else {
                    let pnlClass = 'neutral-color';
                    if (pnl > 0) pnlClass = 'profit-color';
                    else if (pnl < 0) pnlClass = 'loss-color';
                    const pnlText = `${pnl >= 0 ? '+' : ''}${pnl.toFixed(2).replace('.', ',')}`;

                    card.className = 'weekly-summary-card';
                    card.innerHTML = `
                        <p class="week-title">Week ${weekNumber}</p>
                        <p class="week-pnl ${pnlClass}">${pnlText}</p>
                        <p class="week-days">${daysCount} day${daysCount > 1 ? 's' : ''}</p>
                    `;
                }
                this.calendarContainer.appendChild(card);
            }

            createCalendarDay(dayNumber, isOtherMonth = false, isToday = false) {
                const day = document.createElement('div');
                day.className = 'calendar-day text-center p-3 bg-bg-dark rounded-lg cursor-pointer transition-all duration-200';
                
                if(dayNumber > 0) {
                    day.textContent = dayNumber;
                }

                if (isOtherMonth) {
                    day.classList.add('opacity-50');
                }

                if (isToday) {
                    day.classList.add('border-2', 'border-accent-blue');
                }

                if (!isOtherMonth) {
                    day.addEventListener('mouseenter', () => {
                        day.style.transform = 'translateY(-2px)';
                        day.style.boxShadow = '0 4px 6px rgba(255, 87, 34, 0.2)';
                    });

                    day.addEventListener('mouseleave', () => {
                        day.style.transform = 'translateY(0)';
                        day.style.boxShadow = 'none';
                    });
                }

                return day;
            }

            formatDate(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            getWeekNumber(date) {
                const target = new Date(date.valueOf());
                const dayNr = (date.getDay() + 6) % 7;
                target.setDate(target.getDate() - dayNr + 3);
                const firstThursday = target.valueOf();
                target.setMonth(0, 1);
                if (target.getDay() !== 4) {
                    target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);
                }
                return 1 + Math.ceil((firstThursday - target) / 604800000);
            }

            showEntryForm(date) {
                this.entryDateEl.textContent = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Mettre à jour le numéro de semaine
                if (this.weekNumberInput) {
                    this.weekNumberInput.value = this.getWeekNumber(date);
                }

                this.formSection.classList.remove('hidden');
                this.formSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Masquer le conseil du jour
                if (this.dailyTip) {
                    this.dailyTip.classList.add('hidden');
                }

                // Charger les données existantes
                this.loadEntryData(date);
            }

            hideEntryForm() {
                this.formSection.classList.add('hidden');

                // Afficher le conseil du jour
                if (this.dailyTip) {
                    this.dailyTip.classList.remove('hidden');
                }
            }

            switchTab(tabId) {
                // Désactiver tous les boutons
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('bg-accent-blue', 'text-white');
                    btn.classList.add('bg-bg-dark');
                });

                // Masquer tous les contenus
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('block');
                });

                // Activer le bouton et le contenu sélectionnés
                const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
                const activeContent = document.getElementById(`${tabId}-tab`);

                if (activeButton && activeContent) {
                    activeButton.classList.remove('bg-bg-dark');
                    activeButton.classList.add('bg-accent-blue', 'text-white');
                    activeContent.classList.remove('hidden');
                    activeContent.classList.add('block');
                }
            }

            saveEntry() {
                if (!this.selectedDateForEntry) {
                    this.showNotification('Aucune date sélectionnée', 'error');
                    return;
                }

                const formattedDate = this.formatDate(this.selectedDateForEntry);
                const formData = this.collectFormData();

                // Sauvegarder dans le localStorage
                localStorage.setItem(`journal_entry_${formattedDate}`, JSON.stringify(formData));

                // Ajouter à la liste des dates avec entrées
                let datesWithEntries = this.getDatesWithEntries();
                if (!datesWithEntries.includes(formattedDate)) {
                    datesWithEntries.push(formattedDate);
                    localStorage.setItem('journal_dates_with_entries', JSON.stringify(datesWithEntries));
                }

                this.showNotification('Entrée sauvegardée avec succès!', 'success');
                this.renderCalendar();
            }

            collectFormData() {
                const data = {
                    daily: {},
                    trade: {},
                    weekly: {},
                    notes: {
                        general: '',
                        todoList: [],
                        eventList: []
                    },
                    calculator: {}
                };

                // Collecter les données de chaque onglet
                try {
                    // Daily Tab
                    const dailyTab = document.getElementById('daily-tab');
                    if (dailyTab) {
                        data.daily = {
                            pdr: dailyTab.querySelector('select')?.value || '',
                            captureH1: dailyTab.querySelector('input[type="url"]')?.value || '',
                            observations: dailyTab.querySelector('textarea')?.value || '',
                            cycleC1Phase: dailyTab.querySelectorAll('select')[1]?.value || '',
                            cycleC1Capture: dailyTab.querySelectorAll('input[type="url"]')[1]?.value || '',
                            cycleC2Phase: dailyTab.querySelectorAll('select')[2]?.value || '',
                            cycleC2Capture: dailyTab.querySelectorAll('input[type="url"]')[2]?.value || '',
                            setupType: dailyTab.querySelectorAll('select')[3]?.value || '',
                            manipulation: dailyTab.querySelectorAll('select')[4]?.value || '',
                            swingPointSwept: dailyTab.querySelector('input[type="text"]')?.value || '',
                            captureSetup: dailyTab.querySelectorAll('input[type="url"]')[3]?.value || ''
                        };
                    }

                    // Trade Tab
                    const tradeTab = document.getElementById('trade-tab');
                    if (tradeTab) {
                        data.trade = {
                            asset: document.getElementById('asset-select')?.value || '',
                            positionSize: parseFloat(document.getElementById('position-size')?.value) || 0,
                            stopLoss: parseFloat(document.getElementById('stop-loss')?.value) || 0,
                            takeProfit: parseFloat(document.getElementById('take-profit')?.value) || 0,
                            result: document.getElementById('result-select')?.value || '',
                            pnl: document.getElementById('pnl-result')?.value || '',
                            riskReward: document.getElementById('rr-result')?.value || '',
                            review: tradeTab.querySelector('textarea')?.value || ''
                        };
                    }

                    // Weekly Tab
                    const weeklyTab = document.getElementById('weekly-tab');
                    if (weeklyTab) {
                        data.weekly = {
                            pwr: weeklyTab.querySelector('select')?.value || '',
                            weekNumber: document.getElementById('week-number')?.value || '',
                            captureH4: weeklyTab.querySelector('input[type="url"]')?.value || '',
                            observations: weeklyTab.querySelector('textarea')?.value || ''
                        };
                    }

                    // Notes Tab
                    const notesTab = document.getElementById('notes-tab');
                    if (notesTab) {
                        data.notes.general = notesTab.querySelector('textarea')?.value || '';

                        // Collecter les tâches
                        const todoItems = document.querySelectorAll('#todoList li');
                        todoItems.forEach(item => {
                            const checkbox = item.querySelector('input[type="checkbox"]');
                            const text = item.querySelector('.todo-text')?.textContent || '';
                            const priority = item.querySelector('.todo-priority')?.textContent?.length || 1;
                            data.notes.todoList.push({
                                text: text,
                                priority: priority,
                                completed: checkbox?.checked || false
                            });
                        });

                        // Collecter les événements
                        const eventItems = document.querySelectorAll('#eventList li');
                        eventItems.forEach(item => {
                            const time = item.querySelector('.event-time')?.textContent || '';
                            const description = item.querySelector('.event-desc')?.textContent || '';
                            data.notes.eventList.push({
                                time: time,
                                description: description
                            });
                        });
                    }

                    // Calculator Tab
                    const calculatorTab = document.getElementById('calculator-tab');
                    if (calculatorTab) {
                        data.calculator = {
                            capital: document.getElementById('calc-capital')?.value || '',
                            risk: document.getElementById('calc-risk')?.value || '',
                            stopLoss: document.getElementById('calc-sl')?.value || '',
                            takeProfit: document.getElementById('calc-tp')?.value || '',
                            selectedTicker: this.selectedTicker
                        };
                    }

                } catch (error) {
                    console.error('Erreur lors de la collecte des données:', error);
                    this.showNotification('Erreur lors de la sauvegarde', 'error');
                }

                return data;
            }

            loadEntryData(date) {
                const formattedDate = this.formatDate(date);
                const savedData = localStorage.getItem(`journal_entry_${formattedDate}`);

                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        this.populateFormData(data);
                    } catch (error) {
                        console.error('Erreur lors du chargement des données:', error);
                        this.showNotification('Erreur lors du chargement des données', 'error');
                    }
                } else {
                    // Réinitialiser uniquement les champs pertinents, pas tout le formulaire
                    this.journalForm.querySelectorAll('input:not([readonly]), textarea, select').forEach(el => {
                        if (el.type === 'checkbox') el.checked = false;
                        else el.value = '';
                    });
                    document.getElementById('todoList').innerHTML = '';
                    document.getElementById('eventList').innerHTML = '';
                }
            }

            populateFormData(data) {
                if (!data) return;

                try {
                    // Réinitialiser le formulaire
                    this.journalForm.reset();
                    document.getElementById('todoList').innerHTML = '';
                    document.getElementById('eventList').innerHTML = '';

                    // Peupler les données Daily
                    if (data.daily) {
                        const dailyTab = document.getElementById('daily-tab');
                        if (dailyTab) {
                            const selects = dailyTab.querySelectorAll('select');
                            const urlInputs = dailyTab.querySelectorAll('input[type="url"]');
                            const textInputs = dailyTab.querySelectorAll('input[type="text"]');
                            const textareas = dailyTab.querySelectorAll('textarea');

                            if (selects[0]) selects[0].value = data.daily.pdr || '';
                            if (urlInputs[0]) urlInputs[0].value = data.daily.captureH1 || '';
                            if (textareas[0]) textareas[0].value = data.daily.observations || '';
                            if (selects[1]) selects[1].value = data.daily.cycleC1Phase || '';
                            if (urlInputs[1]) urlInputs[1].value = data.daily.cycleC1Capture || '';
                            if (selects[2]) selects[2].value = data.daily.cycleC2Phase || '';
                            if (urlInputs[2]) urlInputs[2].value = data.daily.cycleC2Capture || '';
                            if (selects[3]) selects[3].value = data.daily.setupType || '';
                            if (selects[4]) selects[4].value = data.daily.manipulation || '';
                            if (textInputs[0]) textInputs[0].value = data.daily.swingPointSwept || '';
                            if (urlInputs[3]) urlInputs[3].value = data.daily.captureSetup || '';
                        }
                    }

                    // Peupler les données Trade
                    if (data.trade) {
                        const elements = {
                            assetSelect: document.getElementById('asset-select'),
                            positionSize: document.getElementById('position-size'),
                            stopLoss: document.getElementById('stop-loss'),
                            takeProfit: document.getElementById('take-profit'),
                            resultSelect: document.getElementById('result-select'),
                            pnlResult: document.getElementById('pnl-result'),
                            rrResult: document.getElementById('rr-result'),
                            review: document.querySelector('#trade-tab textarea')
                        };

                        Object.entries(elements).forEach(([key, element]) => {
                            if (element && data.trade[key]) {
                                element.value = data.trade[key];
                            }
                        });
                    }

                    // Peupler les données Weekly
                    if (data.weekly) {
                        const weeklyTab = document.getElementById('weekly-tab');
                        if (weeklyTab) {
                            const select = weeklyTab.querySelector('select');
                            const urlInput = weeklyTab.querySelector('input[type="url"]');
                            const textarea = weeklyTab.querySelector('textarea');
                            const weekNumber = document.getElementById('week-number');

                            if (select) select.value = data.weekly.pwr || '';
                            if (weekNumber) weekNumber.value = data.weekly.weekNumber || '';
                            if (urlInput) urlInput.value = data.weekly.captureH4 || '';
                            if (textarea) textarea.value = data.weekly.observations || '';
                        }
                    }

                    // Peupler les données Notes
                    if (data.notes) {
                        const notesTextarea = document.querySelector('#notes-tab textarea');
                        if (notesTextarea) {
                            notesTextarea.value = data.notes.general || '';
                        }

                        // Recréer les tâches
                        if (data.notes.todoList && data.notes.todoList.length > 0) {
                            data.notes.todoList.forEach(todo => {
                                this.addTodoItem(todo.text, todo.priority, todo.completed);
                            });
                        }

                        // Recréer les événements
                        if (data.notes.eventList && data.notes.eventList.length > 0) {
                            data.notes.eventList.forEach(event => {
                                this.addEventItem(event.time, event.description);
                            });
                        }
                    }

                    // Peupler les données Calculator
                    if (data.calculator) {
                        const calcElements = {
                            capital: document.getElementById('calc-capital'),
                            risk: document.getElementById('calc-risk'),
                            stopLoss: document.getElementById('calc-sl'),
                            takeProfit: document.getElementById('calc-tp')
                        };

                        Object.entries(calcElements).forEach(([key, element]) => {
                            if (element && data.calculator[key]) {
                                element.value = data.calculator[key];
                            }
                        });

                        if (data.calculator.selectedTicker) {
                            this.selectedTicker = data.calculator.selectedTicker;
                        }
                    }

                    // Déclencher les prévisualisations d'images
                    document.querySelectorAll('input[type="url"]').forEach(input => {
                        if (input.value) {
                            const event = new Event('input');
                            input.dispatchEvent(event);
                        }
                    });

                } catch (error) {
                    console.error('Erreur lors du peuplement des données:', error);
                    this.showNotification('Erreur lors du chargement des données', 'error');
                }
            }

            getDatesWithEntries() {
                try {
                    return JSON.parse(localStorage.getItem('journal_dates_with_entries') || '[]');
                } catch (error) {
                    console.error('Erreur lors du chargement des dates:', error);
                    return [];
                }
            }

            setupImagePreviews() {
                document.querySelectorAll('input[type="url"]').forEach(input => {
                    const preview = input.nextElementSibling;
                    if (preview && preview.classList.contains('image-preview')) {
                        input.addEventListener('input', () => {
                            const img = preview.querySelector('img');
                            if (input.value && input.value.startsWith('http')) {
                                img.src = input.value;
                                img.onload = () => {
                                    preview.classList.remove('hidden');
                                };
                                img.onerror = () => {
                                    preview.classList.add('hidden');
                                };
                            } else {
                                preview.classList.add('hidden');
                            }
                        });
                    }
                });
            }

            setupAutoResize() {
                document.querySelectorAll('.auto-resize').forEach(textarea => {
                    textarea.addEventListener('input', function () {
                        this.style.height = 'auto';
                        this.style.height = (this.scrollHeight) + 'px';
                    });
                });
            }

            setupNotesHandlers() {
                // Gestion des tâches
                const todoInput = document.getElementById('todo-input');
                const todoPriority = document.getElementById('todo-priority');
                const addTodoBtn = document.getElementById('add-todo');

                const addTodo = () => {
                    const text = todoInput.value.trim();
                    const priority = parseInt(todoPriority.value);

                    if (text) {
                        this.addTodoItem(text, priority, false);
                        todoInput.value = '';
                        todoPriority.value = '1';
                    }
                };

                addTodoBtn?.addEventListener('click', addTodo);
                todoInput?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addTodo();
                    }
                });

                // Gestion des événements
                const eventTime = document.getElementById('event-time');
                const eventDesc = document.getElementById('event-desc');
                const addEventBtn = document.getElementById('add-event');

                const addEvent = () => {
                    const time = eventTime.value;
                    const description = eventDesc.value.trim();

                    if (time && description) {
                        this.addTodoItem(time, description);
                        eventTime.value = '';
                        eventDesc.value = '';
                    }
                };

                addEventBtn?.addEventListener('click', addEvent);
                eventDesc?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addEvent();
                    }
                });
            }

            addTodoItem(text, priority, completed = false) {
                const todoList = document.getElementById('todoList');
                const li = document.createElement('li');
                li.className = 'todo-item';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completed;
                checkbox.className = 'form-checkbox h-5 w-5 text-accent-blue';

                const prioritySpan = document.createElement('span');
                prioritySpan.className = 'todo-priority text-lg';
                prioritySpan.textContent = '⭐'.repeat(priority);

                const textSpan = document.createElement('span');
                textSpan.className = 'todo-text flex-1';
                textSpan.textContent = text;

                if (completed) {
                    textSpan.classList.add('line-through', 'text-text-secondary');
                } else {
                    textSpan.classList.remove('line-through', 'text-text-secondary');
                }

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-accent-red hover:bg-accent-red hover:text-white p-1 rounded';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => {
                    li.remove();
                });

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        textSpan.classList.add('line-through', 'text-text-secondary');
                    } else {
                        textSpan.classList.remove('line-through', 'text-text-secondary');
                    }
                });

                li.appendChild(checkbox);
                li.appendChild(prioritySpan);
                li.appendChild(textSpan);
                li.appendChild(deleteBtn);

                todoList.appendChild(li);
            }

            addEventItem(time, description) {
                const eventList = document.getElementById('eventList');
                const li = document.createElement('li');
                li.className = 'event-item';

                const timeSpan = document.createElement('span');
                timeSpan.className = 'event-time font-bold text-accent-blue';
                timeSpan.textContent = time;

                const descSpan = document.createElement('span');
                descSpan.className = 'event-desc flex-1';
                descSpan.textContent = description;

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-accent-red hover:bg-accent-red hover:text-white p-1 rounded';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => {
                    li.remove();
                });

                li.appendChild(timeSpan);
                li.appendChild(descSpan);
                li.appendChild(deleteBtn);

                eventList.appendChild(li);
            }

            setupTradeCalculator() {
                const assetSelect = document.getElementById('asset-select');
                const tickValueInput = document.getElementById('tick-value');
                const positionInput = document.getElementById('position-size');
                const stopLossInput = document.getElementById('stop-loss');
                const takeProfitInput = document.getElementById('take-profit');
                const pnlInput = document.getElementById('pnl-result');
                const rrInput = document.getElementById('rr-result');

                const updateTickValue = () => {
                    const selectedAsset = assetSelect.value;
                    if (selectedAsset && this.tickerData[selectedAsset]) {
                        tickValueInput.value = `${this.tickerData[selectedAsset].tickValue}`;
                    } else {
                        tickValueInput.value = '';
                    }
                    calculatePnL();
                    calculateRR();
                };

                const calculatePnL = () => {
                    const selectedAsset = assetSelect.value;
                    const position = parseFloat(positionInput.value) || 0;
                    const stopLoss = parseFloat(stopLossInput.value) || 0;
                    const takeProfit = parseFloat(takeProfitInput.value) || 0;

                    if (selectedAsset && this.tickerData[selectedAsset] && position > 0) {
                        const tickValue = this.tickerData[selectedAsset].tickValue;
                        const tpPnL = (takeProfit * tickValue * position).toFixed(2);
                        const slPnL = (-stopLoss * tickValue * position).toFixed(2);
                        pnlInput.value = `TP: ${tpPnL} | SL: ${slPnL}`;
                    } else {
                        pnlInput.value = '';
                    }
                };

                const calculateRR = () => {
                    const stopLoss = parseFloat(stopLossInput.value) || 0;
                    const takeProfit = parseFloat(takeProfitInput.value) || 0;

                    if (stopLoss > 0 && takeProfit > 0) {
                        const ratio = (takeProfit / stopLoss).toFixed(2);
                        rrInput.value = `1:${ratio}`;
                    } else {
                        rrInput.value = '';
                    }
                };

                // Event listeners
                assetSelect?.addEventListener('change', updateTickValue);
                [positionInput, stopLossInput, takeProfitInput].forEach(input => {
                    input?.addEventListener('input', () => {
                        calculatePnL();
                        calculateRR();
                    });
                });
            }

            setupRiskCalculator() {
                const tickerButtons = document.querySelectorAll('.ticker-btn');
                const calculateBtn = document.getElementById('calculate-btn');
                const results = document.getElementById('calc-results');
                const slLabel = document.getElementById('calc-sl-label');
                const tpLabel = document.getElementById('calc-tp-label');

                const updateSlTpLabels = () => {
                    if (this.selectedTicker === 'GU') {
                        slLabel.textContent = 'Stop Loss (pips)';
                        tpLabel.textContent = 'Take Profit (pips)';
                    } else {
                        slLabel.textContent = 'Stop Loss (ticks)';
                        tpLabel.textContent = 'Take Profit (ticks)';
                    }
                };

                // Sélection du ticker
                tickerButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        // Reset all buttons to secondary style
                        tickerButtons.forEach(b => {
                            b.classList.add('btn-secondary');
                            b.classList.remove('btn-primary');
                        });
                        // Set clicked button to primary style
                        btn.classList.remove('btn-secondary');
                        btn.classList.add('btn-primary');
                        this.selectedTicker = btn.dataset.ticker;
                        updateSlTpLabels(); // Update labels when ticker changes
                    });
                });

                // Calcul
                calculateBtn?.addEventListener('click', () => {
                    this.calculateRisk();
                });

                // Activer le bouton du ticker par défaut au chargement et mettre à jour les labels
                const defaultTickerBtn = document.querySelector(`.ticker-btn[data-ticker="${this.selectedTicker}"]`);
                if (defaultTickerBtn) {
                    defaultTickerBtn.classList.remove('btn-secondary');
                    defaultTickerBtn.classList.add('btn-primary');
                }
                updateSlTpLabels(); // Initial label update
            }

            calculateRisk() {
                const capital = parseFloat(document.getElementById('calc-capital').value) || 0;
                const riskPercent = parseFloat(document.getElementById('calc-risk').value) || 0;
                const stopLossTicks = parseFloat(document.getElementById('calc-sl').value) || 0;
                const takeProfitTicks = parseFloat(document.getElementById('calc-tp').value) || 0;

                if (capital <= 0 || riskPercent <= 0 || stopLossTicks <= 0 || takeProfitTicks <= 0) {
                    this.showNotification('Veuillez remplir tous les champs', 'error');
                    return;
                }

                const tickerInfo = this.tickerData[this.selectedTicker];
                if (!tickerInfo) {
                    this.showNotification('Ticker non valide', 'error');
                    return;
                }

                const riskAmount = capital * (riskPercent / 100);
                const riskPerContract = stopLossTicks * tickerInfo.tickValue;
                const maxContracts = Math.floor(riskAmount / riskPerContract);
                const potentialGain = takeProfitTicks * tickerInfo.tickValue * maxContracts;
                const riskReward = takeProfitTicks / stopLossTicks;

                const tickerUnit = (this.selectedTicker === 'GU') ? 'pip' : 'tick';
                const pointUnit = (this.selectedTicker === 'GU') ? 'pips' : 'point';

                // Afficher les résultats
                document.getElementById('selected-ticker').textContent = this.selectedTicker;
                document.getElementById('rr-display').textContent = `1:${riskReward.toFixed(2)}`;
                document.getElementById('risk-display').textContent = `${riskAmount.toFixed(2)}`;
                document.getElementById('gain-display').textContent = `${potentialGain.toFixed(2)}`;
                document.getElementById('contracts-display').textContent = maxContracts;
                document.getElementById('ticker-info').textContent =
                    `${this.selectedTicker}: ${tickerInfo.tickValue} par ${tickerUnit} (${tickerInfo.tickSize} ${pointUnit})`;

                document.getElementById('calc-results').classList.remove('hidden');
                this.showNotification('Calcul terminé avec succès', 'success');
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            importData(file) {
                if (!file) {
                    this.showNotification('Aucun fichier sélectionné.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        // Restaurer les données dans localStorage
                        for (const key in data) {
                            localStorage.setItem(key, JSON.stringify(data[key]));
                        }
                        this.showNotification('Données importées avec succès!', 'success');
                        // Recharger l'application pour refléter les changements
                        window.location.reload();
                    } catch (e) {
                        console.error('Erreur lors de l\'importation des données:', e);
                        this.showNotification('Fichier JSON invalide.', 'error');
                    }
                };
                reader.readAsText(file);
            }

            exportData() {
                const dataToExport = {};
                // Collecter toutes les entrées de journal
                const datesWithEntries = this.getDatesWithEntries();
                datesWithEntries.forEach(date => {
                    const entry = localStorage.getItem(`journal_entry_${date}`);
                    if (entry) {
                        dataToExport[`journal_entry_${date}`] = JSON.parse(entry);
                    }
                });
                // Collecter les dates avec entrées
                dataToExport['journal_dates_with_entries'] = datesWithEntries;

                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'journal_trading_data.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                this.showNotification('Données exportées avec succès!', 'success');
            }

            clearAllData() {
                if (confirm('Êtes-vous sûr de vouloir effacer TOUTES les données du journal ? Cette action est irréversible.')) {
                    // Effacer toutes les entrées de journal
                    const datesWithEntries = this.getDatesWithEntries();
                    datesWithEntries.forEach(date => {
                        localStorage.removeItem(`journal_entry_${date}`);
                    });
                    // Effacer la liste des dates avec entrées
                    localStorage.removeItem('journal_dates_with_entries');

                    this.showNotification('Toutes les données ont été effacées.', 'success');
                    // Recharger l'application pour refléter les changements
                    window.location.reload();
                }
            }
        }

        // Initialiser l'application quand le DOM est chargé
        document.addEventListener('DOMContentLoaded', () => {
            try {
                const app = new TradingJournal();
                console.log('Application Journal de Trading initialisée avec succès');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de l\'application:', error);

                // Afficher une notification d'erreur
                const errorDiv = document.createElement('div');
                errorDiv.className = 'notification error';
                errorDiv.textContent = 'Erreur lors du chargement de l\'application';
                document.body.appendChild(errorDiv);

                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }
        });
    </script>
</body>

</html>
