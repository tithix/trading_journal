<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journal de Trading A.M.E.D</title>

    <!-- Tailwind CSS via jsDelivr -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css?v=1.1" rel="stylesheet">

    <!-- Font Awesome pour les icônes -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@100;200;400;500;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* Amélioration de la réactivité pour s'adapter à différentes tailles d'écran */
        @media (max-width: 1440px) {
            html {
                font-size: 15px;
            }
        }

        @media (max-width: 1280px) {
            html {
                font-size: 14px;
            }
        }

        @media (max-width: 1024px) {
            html {
                font-size: 13px;
            }
        }
    </style>

    <style>
        :root {
            --bg-dark: #131722;
            --bg-light: #1e222d;
            --border-color: #2a2e39;
            --text-primary: #d1d4dc;
            --text-secondary: #8a91a0;
            --accent-blue: #FF5722;
            --accent-green: #26a69a;
            --accent-red: #ef5350;
            --accent-yellow: #FFD700;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-primary);
        }

        .bg-bg-dark {
            background-color: var(--bg-dark);
        }

        .bg-bg-light {
            background-color: var(--bg-light);
        }

        .border-border-color {
            border-color: var(--border-color);
        }

        .text-text-primary {
            color: var(--text-primary);
        }

        .text-text-secondary {
            color: var(--text-secondary);
        }

        .text-accent-blue {
            color: var(--accent-blue);
        }

        .text-accent-green {
            color: var(--accent-green);
        }

        .text-accent-red {
            color: var(--accent-red);
        }

        .text-accent-yellow {
            color: var(--accent-yellow);
        }

        .bg-accent-blue {
            background-color: var(--accent-blue);
        }

        .bg-accent-green {
            background-color: var(--accent-green);
        }

        .bg-accent-red {
            background-color: var(--accent-red);
        }

        .bg-accent-yellow {
            background-color: var(--accent-yellow);
        }

        .border-accent-blue {
            border-color: var(--accent-blue);
        }

        .hover\:bg-accent-blue:hover {
            background-color: var(--accent-blue);
        }

        .hover\:text-accent-blue:hover {
            color: var(--accent-blue);
        }

        .focus\:ring-accent-blue:focus {
            --tw-ring-color: var(--accent-blue);
        }

        /* Styles personnalisés pour l'interface */
        .calendar-day {
            transition: all 0.2s ease;
            min-height: 80px;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .calendar-day:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(255, 87, 34, 0.2);
        }

        .indicators-container {
            position: absolute;
            right: 0.3rem;
            top: 0;
            bottom: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
            padding: 0.2rem 0;
        }

        .indicator {
            font-size: 0.8rem;
            line-height: 1;
        }

        .indicator.note-indicator {
            color: var(--accent-yellow);
        }

        .indicator.daily-indicator {
            color: var(--accent-blue);
        }

        .tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-card {
            background: linear-gradient(145deg, #1a1f2b, #232936);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .modern-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23FF5722' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }

        .auto-resize {
            resize: vertical;
            overflow: hidden;
            min-height: 100px;
        }

        /* Styles pour le calendrier */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
        }

        .calendar-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        /* Styles pour les formulaires */
        .form-input {
            background-color: var(--bg-dark);
            border: 1px solid #4B5563;
            /* Modern discrete border */
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
        }

        /* Remove arrows from number inputs */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type=number] {
            -moz-appearance: textfield;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        .form-select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: var(--bg-dark);
            border: none;
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease;
        }

        .form-select:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        /* Styles pour les boutons */
        .btn-primary {
            background-color: var(--accent-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: none;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-primary:hover {
            background-color: #e64a19;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background-color: var(--bg-dark);
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .btn-secondary:hover {
            background-color: var(--accent-blue);
            color: white;
        }

        /* Styles pour les listes */
        .todo-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--bg-dark);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        .event-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            background-color: var(--bg-dark);
            padding: 0.5rem;
            border-radius: 0.5rem;
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        /* Styles pour les images preview */
        .image-preview {
            margin-top: 0.75rem;
            border-radius: 0.5rem;
            overflow: hidden;
            max-width: 100%;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .image-preview>a {
            width: calc((100% - 0.5rem) / 2);
            /* (100% - 1 * gap) / 2 */
        }

        .image-preview img {
            width: 100%;
            height: auto;
            display: block;
            object-fit: cover;
            border-radius: 0.25rem;
        }

        /* Styles pour les notifications */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem;
            border-radius: 0.5rem;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background-color: var(--accent-green);
        }

        .notification.error {
            background-color: var(--accent-red);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive design */
        @media (max-width: 768px) {

            /* General Layout */
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }

            section.bg-bg-light {
                padding: 1rem;
            }

            /* Header */
            header.bg-bg-light {
                padding: 1rem;
                margin-bottom: 1.5rem;
            }

            header .flex-col.md\:flex-row {
                flex-direction: column;
                align-items: center;
            }

            header h1 {
                font-size: 1.5rem;
                /* 24px */
            }

            header nav {
                margin-top: 1rem;
            }

            /* Calendar */
            #calendar-container {
                grid-template-columns: repeat(7, 1fr);
                /* Remove the 8th column */
                gap: 0.25rem;
            }

            #calendar-container>div.text-center.font-bold {
                padding: 0.25rem;
                font-size: 0.75rem;
            }

            #calendar-container>div:nth-child(8) {
                display: none;
                /* Hide "Résultats Hebdo" header */
            }

            #calendar-container>.weekly-summary-card {
                display: none;
                /* Hide weekly summary cards */
            }

            .calendar-day {
                min-height: 55px;
                font-size: 0.8rem;
                padding: 0.25rem;
                display: flex;
                flex-direction: column;
                justify-content: flex-start;
                align-items: center;
            }

            .indicators-container {
                position: static;
                display: flex;
                flex-direction: row;
                justify-content: center;
                gap: 0.3rem;
                width: 100%;
                padding: 0.1rem 0;
                order: 1;
                /* Place indicators below the day number */
            }

            .indicator {
                font-size: 0.65rem;
            }

            #currentMonthYear {
                font-size: 1.25rem;
            }

            /* Form Tabs */
            .tab-button {
                padding: 0.5rem 0.5rem;
                font-size: 0.8rem;
            }

            .tab-button .fas {
                margin-right: 0.25rem;
            }

            /* Form Section */
            #form-section {
                padding: 1rem;
            }

            #journal-form .grid-cols-1.md\:grid-cols-2 {
                grid-template-columns: 1fr;
            }

            #journal-form .form-input,
            #journal-form .form-select {
                width: 100%;
            }

            #journal-form .w-1\/2 {
                width: 100%;
            }

            /* Form Buttons at the bottom */
            #journal-form>div:last-child {
                flex-direction: column-reverse;
                gap: 1rem;
            }

            #journal-form>div:last-child>div {
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            #journal-form>div:last-child>div>button {
                width: 100%;
                justify-content: center;
            }

            /* Help Section */
            #help-section .grid {
                grid-template-columns: 1fr;
            }
        }

        /* Media query for screens between 769px and 1023px (typical for smaller laptops) */
        @media (min-width: 769px) and (max-width: 1023px) {
            .calendar-day {
                min-height: 55px;
                /* Further adjusted for better fit on medium screens */
            }
        }

        /* Styles pour la colonne des résultats hebdomadaires */
        .weekly-summary-card {
            background-color: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            /* 8px */
            padding: 0.75rem;
            /* 12px */
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 0.25rem;
            /* 4px */
        }

        .week-title {
            font-size: 0.875rem;
            /* 14px */
            color: var(--text-secondary);
            font-weight: 500;
        }

        .week-pnl {
            font-size: 1.25rem;
            /* 20px */
            font-weight: 700;
            /* bold */
            line-height: 1.2;
        }

        .week-days {
            font-size: 0.75rem;
            /* 12px */
            color: var(--text-secondary);
        }

        .profit-color {
            color: var(--accent-green);
        }

        .loss-color {
            color: var(--accent-red);
        }

        .neutral-color {
            color: var(--text-primary);
        }

        .other-month {
            background-color: #222733 !important;
        }

        .btn-like-consistency {
            background-color: var(--bg-dark);
            border: 1px solid var(--accent-blue);
            color: var(--text-primary);
        }

        .btn-like-consistency:hover {
            background-color: var(--accent-blue);
            color: white;
            transform: translateY(-1px);
        }

        /* Styles pour les boutons de la calculatrice */
        #calculator-tab .ticker-btn.btn-secondary {
            background-color: black;
            /* Fond noir par défaut */
        }

        #calculator-tab .ticker-btn.btn-secondary:hover {
            background-color: var(--bg-light);
            /* Garde un fond sombre au survol */
            border-color: var(--accent-blue);
        }
    </style>
    <style>
        /* Styles for Consistency Tab - Themed */
        #consistency-tab {
            color: var(--text-primary);
        }

        .card {
            background-color: var(--bg-light);
            border: 1px solid var(--border-color);
        }

        .card h2,
        .card h1 {
            color: var(--text-primary);
        }

        .subtitle-artistic {
            color: var(--text-secondary);
        }

        .help-btn {
            background-color: var(--accent-blue);
            color: white;
        }

        .modern-select {
            background-color: var(--bg-dark);
            border-color: var(--border-color);
            color: var(--text-primary);
        }

        .modern-select:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        .modern-select-wrapper::after {
            color: var(--accent-blue);
        }

        #consistency-tab .form-input,
        #consistency-tab input[type=number] {
            background-color: var(--bg-dark);
            /* border is now handled by the global .form-input class */
            color: var(--text-primary);
        }

        #consistency-tab .form-input:focus,
        #consistency-tab input[type=number]:focus {
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 2px rgba(255, 87, 34, 0.2);
        }

        #consistency-tab .btn-primary,
        #consistency-tab .btn-danger {
            background-color: var(--bg-dark);
            border: 1px solid var(--accent-blue);
            color: var(--text-primary);
        }

        #consistency-tab .btn-primary:hover,
        #consistency-tab .btn-danger:hover {
            background-color: var(--accent-blue);
            color: white;
        }

        #consistency-tab .text-emerald-300 {
            color: var(--accent-green);
        }

        #consistency-tab .text-rose-400 {
            color: var(--accent-red);
        }

        #consistency-tab .bg-slate-800 {
            background-color: var(--bg-dark);
        }

        #consistency-tab .border-slate-700 {
            border-color: var(--border-color);
        }

        #consistency-tab .text-slate-300 {
            color: var(--text-primary);
        }

        #consistency-tab .text-slate-400 {
            color: var(--text-secondary);
        }

        #consistency-tab .text-slate-500 {
            color: var(--text-secondary);
        }

        #consistency-tab .bg-slate-800\/50 {
            background-color: rgba(30, 34, 45, 0.5);
        }

        #consistency-tab .divide-slate-700> :not([hidden])~ :not([hidden]) {
            border-color: var(--border-color);
        }

        #consistency-tab .text-blue-400 {
            color: var(--accent-blue);
        }

        #consistency-tab .text-purple-400 {
            color: var(--accent-yellow);
        }

        #consistency-tab .text-amber-400 {
            color: var(--accent-yellow);
        }

        #consistency-tab .bg-slate-700 {
            background-color: var(--bg-light);
        }

        #consistency-tab .bg-gradient-to-r.from-blue-500.via-emerald-400.to-yellow-300 {
            background-image: linear-gradient(to right, var(--accent-blue), var(--accent-green), var(--accent-yellow));
        }

        #consistency-tab .bg-gradient-to-r.from-blue-500.to-emerald-400 {
            background-image: linear-gradient(to right, var(--accent-blue), var(--accent-green));
        }

        /* Styles for Cal-Eco Tab */
        #cal-eco-tab h1 {
            font-size: 1.5rem;
            /* 24px */
            font-weight: 700;
            /* bold */
            margin-bottom: 1rem;
            /* 16px */
        }

        #cal-eco-tab p {
            margin-bottom: 1rem;
            /* 16px */
        }

        #cal-eco-tab table {
            width: 100%;
            border-collapse: collapse;
            color: var(--text-primary);
        }

        #cal-eco-tab th,
        #cal-eco-tab td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            /* 12px */
            text-align: left;
        }

        #cal-eco-tab th {
            background-color: var(--bg-dark);
            font-weight: 600;
            /* semibold */
        }

        #cal-eco-tab .impact-high {
            color: var(--accent-red);
            font-weight: bold;
        }
    </style>
</head>

<body class="min-h-screen leading-relaxed">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <header class="bg-bg-light rounded-xl p-6 mb-8 border border-border-color shadow-lg">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <h1
                        class="text-3xl font-bold text-accent-blue font-montserrat flex items-center justify-center md:justify-start">
                        <i class="fas fa-chart-bar mr-2"></i>
                        Journal de Trading A.M.E.D
                    </h1>
                    <p class="text-text-secondary mt-2 font-montserrat">Enregistrez et analysez vos trades selon les
                        cycles Intraday</p>
                </div>
                <nav>
                    <button id="help-btn" class="btn-primary flex items-center">
                        <i class="fas fa-question-circle mr-2"></i>
                        Aide
                    </button>
                </nav>
            </div>
        </header>

        <!-- Section d'aide -->
        <div id="help-section" class="hidden mb-8 bg-bg-light rounded-xl border border-border-color shadow-lg p-6">
            <h2 class="text-xl font-bold text-accent-blue mb-4 flex items-center">
                <i class="fas fa-info-circle mr-2"></i>
                Aide & Introduction
            </h2>
            <p class="mb-4">Bienvenue dans le <strong>Journal de Trading A.M.E.D</strong>. Cet outil est conçu pour vous
                aider à structurer votre routine de trading, à analyser vos performances et à maintenir une discipline
                rigoureuse en suivant les cycles de marché Intraday.</p>

            <div class="space-y-6">
                <!-- Section Calendrier -->
                <div class="bg-bg-dark p-4 rounded-lg">
                    <h3 class="font-bold text-accent-blue mb-2">Fonctionnement du Calendrier</h3>
                    <p>Le calendrier est votre point d'entrée. Cliquez sur une date pour ouvrir le formulaire et
                        enregistrer vos données pour ce jour. Les indicateurs sur chaque case vous renseignent sur les
                        données déjà sauvegardées :</p>
                    <ul class="list-disc pl-5 mt-2 text-text-secondary">
                        <li><span class="text-accent-green font-bold">✅ Trade Gagnant</span> / <span
                                class="text-accent-red font-bold">❌ Trade Perdant</span></li>
                        <li><i class="fas fa-calendar-week text-accent-blue"></i> Entrée "Daily" enregistrée</li>
                        <li><i class="fas fa-sticky-note text-accent-yellow"></i> Note ou événement enregistré</li>
                    </ul>
                </div>

                <!-- Section Onglets -->
                <div>
                    <h3 class="text-lg font-bold text-accent-blue mb-3">Détail des Onglets</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Daily</h4>
                            <p class="text-sm">Analysez le contexte du jour : tendance du jour précédent (PDR), et
                                phases des cycles C1/C2/C3. Ajoutez des captures d'écran pour chaque étape.</p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Trade</h4>
                            <p class="text-sm">Enregistrez les détails précis de votre trade : actif, taille, SL/TP, et
                                résultat. Le P&L et le ratio R/R sont calculés automatiquement.</p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Weekly</h4>
                            <p class="text-sm">Prenez du recul avec l'analyse hebdomadaire. Notez la tendance de la
                                semaine précédente (PWR) et vos observations générales.</p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Notes</h4>
                            <p class="text-sm">Utilisez cet espace pour vos pense-bêtes, listes de tâches (avec
                                priorités) et pour noter les événements économiques importants de la journée.</p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Calculatrice</h4>
                            <p class="text-sm">Un outil rapide pour calculer le risque, la taille de position maximale
                                et le gain potentiel en fonction de votre capital et de votre stratégie.</p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                            <h4 class="font-bold mb-2">Consistency</h4>
                            <p class="text-sm">Suivez votre régularité. Cet analyseur avancé vous aide à respecter les
                                règles des prop firms (drawdown, profit target, etc.).</p>
                        </div>
                    </div>
                </div>

                <!-- Section Gestion des Données -->
                <div>
                    <h3 class="text-lg font-bold text-accent-blue mb-3">Gestion de vos Données</h3>
                    <div class="bg-bg-dark p-4 rounded-lg">
                        <p>Vos données sont précieuses. Utilisez les boutons en bas du formulaire pour les gérer :</p>
                        <ul class="list-disc pl-5 mt-2 text-text-secondary">
                            <li><strong>Importer :</strong> Chargez un fichier de sauvegarde (format JSON) pour
                                restaurer vos données.</li>
                            <li><strong>Sauvegarder :</strong> Exportez toutes vos entrées dans un fichier JSON.
                                Faites-le régulièrement !</li>
                            <li><strong>Effacer :</strong> Supprimez toutes les données du journal. <span
                                    class="text-accent-red font-bold">Attention, cette action est irréversible.</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mt-6 text-center">
                <p class="text-text-secondary">Cliquez à nouveau sur le bouton "Aide" pour masquer cette section.</p>
            </div>
        </div>

        <main class="grid grid-cols-1 lg:grid-cols-1 gap-8">
            <!-- Calendrier et Résultats Hebdo Section -->
            <section class="bg-bg-light p-6 rounded-xl border border-border-color shadow-lg mb-8">
                <!-- Header du Calendrier -->
                <div class="flex justify-between items-center mb-6">
                    <button id="prevMonth"
                        class="text-accent-blue hover:text-orange-300 p-2 rounded-full hover:bg-bg-dark transition">
                        <i class="fas fa-chevron-left text-xl"></i>
                    </button>
                    <h2 id="currentMonthYear" class="text-xl font-bold text-center"></h2>
                    <button id="nextMonth"
                        class="text-accent-blue hover:text-orange-300 p-2 rounded-full hover:bg-bg-dark transition">
                        <i class="fas fa-chevron-right text-xl"></i>
                    </button>
                </div>

                <!-- Grille Principale (Calendrier + Résultats) -->
                <div id="calendar-container" class="grid"
                    style="grid-template-columns: repeat(7, 1fr) auto; gap: 0.5rem;">
                    <!-- Headers de la grille (Lun-Dim + Hebdo) -->
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Lun</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Mar</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Mer</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Jeu</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Ven</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Sam</div>
                    <div class="text-center font-bold p-2 bg-bg-dark rounded-lg">Dim</div>
                    <div class="text-center font-normal p-2 bg-accent-blue rounded-lg text-white">Résultats Hebdo</div>

                    <!-- Le contenu du calendrier (jours) et les résultats hebdo seront injectés ici par JS -->
                </div>
            </section>

            <!-- Conseil du jour -->
            <section id="daily-tip-section"
                class="bg-bg-light p-6 rounded-xl border border-border-color shadow-lg mb-8">
                <h3 class="font-bold text-accent-blue mb-3 flex items-center">
                    <i class="fas fa-lightbulb mr-2"></i>
                    Conseil du jour
                </h3>
                <p class="text-base text-center">La patience est la clé. Attendez que votre setup se présente, ne le
                    forcez pas.</p>
            </section>

            <!-- Formulaire Section -->
            <section id="form-section" class="hidden bg-bg-light p-6 rounded-xl border border-border-color shadow-lg">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Nouvelle Entrée pour le <span id="entry-date"
                            class="text-accent-blue"></span></h2>
                    <button id="close-form" class="text-text-secondary hover:text-accent-blue text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>

                <!-- Tabs Navigation -->
                <div class="flex flex-wrap mb-6 border-b border-border-color">
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-accent-blue text-white flex items-center border border-accent-blue"
                        data-tab="daily">
                        <i class="fas fa-sun mr-2"></i>
                        Daily
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="trade">
                        <i class="fas fa-dollar-sign mr-2"></i>
                        Trade
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="weekly">
                        <i class="fas fa-calendar-week mr-2"></i>
                        Weekly
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg mr-2 bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="notes">
                        <i class="fas fa-sticky-note mr-2"></i>
                        Notes
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="calculator">
                        <i class="fas fa-calculator mr-2"></i>
                        Calculatrice
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="consistency">
                        <i class="fas fa-chart-line mr-2"></i>
                        Consistency
                    </button>
                    <button
                        class="tab-button px-4 py-2 font-medium rounded-t-lg bg-bg-dark hover:bg-bg-light transition flex items-center border border-accent-blue"
                        data-tab="cal-eco">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        Cal-Éco
                    </button>
                </div>

                <form id="journal-form" class="space-y-6">
                    <!-- Daily Tab -->
                    <div id="daily-tab" class="tab-content block">
                        <div class="space-y-4">
                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Tendance du PDR
                                    (Previous Day Range)</h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">PDR</label>
                                        <select id="daily-pdr" class="form-select modern-select w-1/2">
                                            <option value="">-- Sélectionner --</option>
                                            <option value="bullish">Bullish</option>
                                            <option value="bearish">Bearish</option>
                                            <option value="consolidation">Consolidation</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Capture H1 (URL)</label>
                                        <input id="daily-captureH1" type="text"
                                            class="form-input w-full image-url-input"
                                            placeholder="Coller un ou plusieurs liens d'image...">
                                        <div class="image-preview hidden"></div>
                                    </div>
                                </div>
                                <div class="mt-4">
                                    <label class="block text-text-secondary mb-2">Observations</label>
                                    <textarea id="daily-observations" class="form-input w-full auto-resize"
                                        placeholder="Ex: Attente d'un retour sur le FVG..."></textarea>
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C1</h3>
                                    <label class="block text-text-secondary mb-2">Phase C1</label>
                                    <select id="daily-cycleC1Phase" class="form-select modern-select w-1/2">
                                        <option value="">-- Sélectionner --</option>
                                        <option value="accumulation">Accumulation</option>
                                        <option value="re-accumulation">Ré-Accumulation</option>
                                        <option value="distribution">Distribution</option>
                                        <option value="re-distribution">Re-Distribution</option>
                                        <option value="continuation">Continuation</option>
                                        <option value="reversal">Renversement</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Capture C1 (URL)</label>
                                        <input id="daily-cycleC1Capture" type="text"
                                            class="form-input w-full image-url-input"
                                            placeholder="Coller un ou plusieurs liens d'image...">
                                        <div class="image-preview hidden"></div>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C2</h3>
                                    <label class="block text-text-secondary mb-2">Phase C2</label>
                                    <select id="daily-cycleC2Phase" class="form-select modern-select w-1/2">
                                        <option value="">-- Sélectionner --</option>
                                        <option value="accumulation">Accumulation</option>
                                        <option value="re-accumulation">Ré-Accumulation</option>
                                        <option value="distribution">Distribution</option>
                                        <option value="re-distribution">Re-Distribution</option>
                                        <option value="continuation">Continuation</option>
                                        <option value="reversal">Renversement</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Capture C2 (URL)</label>
                                        <input id="daily-cycleC2Capture" type="text"
                                            class="form-input w-full image-url-input"
                                            placeholder="Coller un ou plusieurs liens d'image...">
                                        <div class="image-preview hidden"></div>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Cycle C3 & Setup
                                </h3>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">Type de Setup</label>
                                        <select id="daily-setupType" class="form-select modern-select w-1/2">
                                            <option value="">-- Sélectionner --</option>
                                            <option value="long">Long</option>
                                            <option value="short">Short</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Manipulation</label>
                                        <select id="daily-manipulation" class="form-select modern-select w-1/2">
                                            <option value="">-- Sélectionner --</option>
                                            <option value="bullish_shorts">Bullish (for Shorts)</option>
                                            <option value="bearish_longs">Bearish (for Longs)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                                    <div>
                                        <label class="block text-text-secondary mb-2">Swing Point balayé</label>
                                        <input id="daily-swingPointSwept" type="text" class="form-input w-full"
                                            placeholder="Ex: PDL, PWH, Swing Low M15">
                                    </div>
                                    <div>
                                        <label class="block text-text-secondary mb-2">Capture Setup (URL)</label>
                                        <input id="daily-captureSetup" type="text"
                                            class="form-input w-full image-url-input"
                                            placeholder="Coller un ou plusieurs liens d'image...">
                                        <div class="image-preview hidden"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Trade Tab -->
                    <div id="trade-tab" class="tab-content hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-text-secondary mb-2">Actif</label>
                                <select id="asset-select" class="form-select modern-select w-full">
                                    <option value="">- Sélectionner -</option>
                                    <option value="EUR/USD" data-tick="0.0001">EUR/USD</option>
                                    <option value="GBP/USD" data-tick="0.0001">GBP/USD</option>
                                    <option value="MNQ" data-tick="0.25">MNQ</option>
                                    <option value="NQ" data-tick="0.25">NQ</option>
                                    <option value="US100" data-tick="0.01">US100</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">$/Tick - $/Pip</label>
                                <input type="text" id="tick-value" readonly class="form-input w-full opacity-70">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Taille de position</label>
                                <input type="number" id="position-size" class="form-input w-full" min="0.01" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Stop Loss</label>
                                <input type="number" id="stop-loss" class="form-input w-full" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Take Profit</label>
                                <input type="number" id="take-profit" class="form-input w-full" step="any">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Résultat</label>
                                <select id="result-select" class="form-select modern-select w-full">
                                    <option value="">- Sélectionner -</option>
                                    <option value="win">Gagnant</option>
                                    <option value="loss">Perdant</option>
                                    <option value="breakeven">Breakeven</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">P&L</label>
                                <input type="text" id="pnl-result" readonly class="form-input w-full">
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Ratio R/R (TP/SL)</label>
                                <input type="text" id="rr-result" readonly class="form-input w-full">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-text-secondary mb-2">Revue du Trade</label>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Ai-je respecté le plan ? Leçons..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Weekly Tab -->
                    <div id="weekly-tab" class="tab-content hidden">
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Tendance du PWR
                                (Previous Week Range)</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-text-secondary mb-2">PWR</label>
                                    <select class="form-select modern-select w-1/2">
                                        <option value="">-- Sélectionner --</option>
                                        <option value="bullish">Bullish</option>
                                        <option value="bearish">Bearish</option>
                                        <option value="consolidation">Consolidation</option>
                                    </select>
                                    <div class="mt-4">
                                        <label class="block text-text-secondary mb-2">Semaine #</label>
                                        <input type="text" id="week-number" class="form-input w-full" readonly>
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-text-secondary mb-2">Capture H4 (URL)</label>
                                    <input id="weekly-captureH4" type="text" class="form-input w-full image-url-input"
                                        placeholder="Coller un ou plusieurs liens d'image...">
                                    <div class="image-preview hidden"></div>
                                </div>
                            </div>
                            <div>
                                <label class="block text-text-secondary mb-2">Obs/Notes</label>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Observations et notes..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Notes Tab -->
                    <div id="notes-tab" class="tab-content hidden">
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Notes Générales /
                                    Pense-bêtes</h3>
                                <textarea class="form-input w-full auto-resize"
                                    placeholder="Écrivez vos notes générales ici..."></textarea>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Liste de Tâches
                                    (To-Do)</h3>
                                <div class="flex items-center gap-2 mb-4">
                                    <input type="text" id="todo-input" class="form-input flex-grow"
                                        placeholder="Nouvelle tâche...">
                                    <select id="todo-priority" class="form-select modern-select">
                                        <option value="">-- Sélectionner --</option>
                                        <option value="1">⭐</option>
                                        <option value="2">⭐⭐</option>
                                        <option value="3">⭐⭐⭐</option>
                                    </select>
                                    <button type="button" id="add-todo" class="btn-primary">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <ul id="todoList" class="space-y-2"></ul>
                            </div>

                            <div>
                                <h3 class="text-lg font-bold mb-3 border-l-4 border-accent-blue pl-2">Événements
                                    Économiques Importants</h3>
                                <div class="flex items-center gap-2 mb-4">
                                    <input type="time" id="event-time" class="form-input">
                                    <input type="text" id="event-desc" class="form-input flex-grow"
                                        placeholder="Description de l'événement...">
                                    <button type="button" id="add-event" class="btn-primary">
                                        <i class="fas fa-plus"></i>
                                    </button>
                                </div>
                                <ul id="eventList" class="space-y-2"></ul>
                            </div>
                        </div>
                    </div>

                    <!-- Calculator Tab -->
                    <div id="calculator-tab" class="tab-content hidden">
                        <div class="bg-bg-light rounded-xl border border-border-color overflow-hidden">
                            <div class="p-6">
                                <h2 class="text-lg font-semibold text-text-primary mb-4">Calculatrice de Risque</h2>
                                <div class="grid grid-cols-2 gap-3 mb-6">
                                    <button class="ticker-btn btn-secondary" data-ticker="NQ">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        NQ
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="MNQ">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        MNQ
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="GU">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        GU & EU
                                    </button>
                                    <button class="ticker-btn btn-secondary" data-ticker="US100">
                                        <i class="fas fa-chart-line mr-2"></i>
                                        US100
                                    </button>
                                </div>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1">Capital
                                            ($)</label>
                                        <input type="number" id="calc-capital" class="form-input w-full"
                                            placeholder="10000">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1">Risk
                                            (%)</label>
                                        <input type="number" id="calc-risk" class="form-input w-full" placeholder="1">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1"
                                            id="calc-sl-label">Stop Loss
                                            (ticks)</label>
                                        <input type="number" id="calc-sl" class="form-input w-full" placeholder="10">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-text-secondary mb-1"
                                            id="calc-tp-label">Take Profit
                                            (ticks)</label>
                                        <input type="number" id="calc-tp" class="form-input w-full" placeholder="20">
                                    </div>
                                </div>

                                <button id="calculate-btn"
                                    class="btn-like-consistency flex items-center justify-center px-6 py-2 rounded-lg transition mx-auto mb-6">
                                    <i class="fas fa-calculator mr-2"></i>
                                    Calculer
                                </button>

                                <div id="calc-results" class="hidden">
                                    <h2 class="text-lg font-semibold text-text-primary mb-4">Résultats pour <span
                                            id="selected-ticker" class="text-accent-blue">NQ</span></h2>
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-balance-scale text-accent-blue mr-2"></i>
                                                <span class="font-medium text-text-primary">Risk/Reward</span>
                                            </div>
                                            <div id="rr-display" class="text-2xl font-bold text-accent-blue">1:2</div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-exclamation-triangle text-accent-red mr-2"></i>
                                                <span class="font-medium text-text-primary">Risk ($)</span>
                                            </div>
                                            <div id="risk-display" class="text-2xl font-bold text-accent-red">$100</div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-arrow-trend-up text-accent-green mr-2"></i>
                                                <span class="font-medium text-text-primary">Gain potentiel ($)</span>
                                            </div>
                                            <div id="gain-display" class="text-2xl font-bold text-accent-green">$200
                                            </div>
                                        </div>
                                        <div class="result-card p-4 rounded-lg">
                                            <div class="flex items-center mb-2">
                                                <i class="fas fa-cubes text-blue-400 mr-2"></i>
                                                <span class="font-medium text-text-primary">Contrats max</span>
                                            </div>
                                            <div id="contracts-display" class="text-2xl font-bold text-blue-400">2</div>
                                        </div>
                                    </div>
                                    <div class="mt-4 text-sm text-text-secondary">
                                        <p id="ticker-info">NQ: $5 par tick (0.25 point) | $20 par point</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Consistency Tab -->
                    <div id="consistency-tab" class="tab-content hidden">
                        <div id="consistency-app" class="container mx-auto px-2 sm:px-4 py-8 max-w-6xl"></div>
                        <div id="helpModal" class="modal-bg" style="display:none;">
                            <div class="modal-content">
                                <button class="modal-close" id="closeHelpModal" title="Close">&times;</button>
                                <h2>Instructions</h2>
                                <div id="helpModalContent"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Cal-Eco Tab -->
                    <div id="cal-eco-tab" class="tab-content hidden">
                        <h1>Calendrier Économique - USD <i class="fas fa-folder" style="color: red;"></i></h1>
                        <p id="week-dates">Données pour la semaine du: jj/mm au jj/mm/aa</p>
                        <table id="calendar-table">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Heure (EST | Paris)</th>
                                    <th>Devise</th>
                                    <th>Importance</th>
                                    <th>Événement</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Les données seront insérées ici par JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div class="pt-6 flex justify-between items-center">
                        <div class="flex gap-4">
                            <input type="file" id="importDataInput" accept="application/json" class="hidden" />
                            <button type="button" id="importDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-upload mr-2"></i>
                                Importer
                            </button>
                            <button type="button" id="exportDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-download mr-2"></i>
                                Sauvegarder
                            </button>
                            <button type="button" id="clearDataBtn" class="btn-secondary flex items-center">
                                <i class="fas fa-eraser mr-2"></i>
                                Effacer
                            </button>
                        </div>
                        <div class="flex gap-4">
                            <button type="button" id="cancel-btn" class="btn-secondary">
                                <i class="fas fa-times mr-2"></i>
                                Annuler
                            </button>
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-save mr-2"></i>
                                Enregistrer
                            </button>
                        </div>
                    </div>
                </form>
            </section>
        </main>

        <footer class="text-center text-text-secondary py-6 mt-8">
            <div class="flex flex-col sm:flex-row justify-center items-center">
                <div class="flex items-center">
                    <i class="fas fa-code mr-2 text-accent-blue"></i>
                    Powered by 3drives - © 2025 - Thitix
                </div>
            </div>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Data and functions for Economic Calendar
        const economicCalendarJsonData = [{ "title": "BusinessNZ Services Index", "country": "NZD", "date": "2025-07-13T18:30:00-04:00", "impact": "Low", "forecast": "", "previous": "44.0" }, { "title": "Core Machinery Orders m/m", "country": "JPY", "date": "2025-07-13T19:50:00-04:00", "impact": "Low", "forecast": "-1.4%", "previous": "-9.1%" }, { "title": "USD-Denominated Trade Balance", "country": "CNY", "date": "2025-07-13T23:00:00-04:00", "impact": "Low", "forecast": "113.2B", "previous": "103.2B" }, { "title": "Trade Balance", "country": "CNY", "date": "2025-07-13T23:07:00-04:00", "impact": "Low", "forecast": "785B", "previous": "744B" }, { "title": "Revised Industrial Production m/m", "country": "JPY", "date": "2025-07-14T00:30:00-04:00", "impact": "Low", "forecast": "0.5%", "previous": "0.5%" }, { "title": "Tertiary Industry Activity m/m", "country": "JPY", "date": "2025-07-14T00:30:00-04:00", "impact": "Low", "forecast": "0.1%", "previous": "0.3%" }, { "title": "French Bank Holiday", "country": "EUR", "date": "2025-07-14T02:01:00-04:00", "impact": "Holiday", "forecast": "", "previous": "" }, { "title": "PPI m/m", "country": "CHF", "date": "2025-07-14T02:30:00-04:00", "impact": "Low", "forecast": "0.2%", "previous": "-0.5%" }, { "title": "M2 Money Supply y/y", "country": "CNY", "date": "2025-07-14T03:02:00-04:00", "impact": "Low", "forecast": "8.2%", "previous": "7.9%" }, { "title": "New Loans", "country": "CNY", "date": "2025-07-14T03:03:00-04:00", "impact": "Medium", "forecast": "1960B", "previous": "620B" }, { "title": "Eurogroup Meetings", "country": "EUR", "date": "2025-07-14T05:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Wholesale Sales m/m", "country": "CAD", "date": "2025-07-14T08:30:00-04:00", "impact": "Low", "forecast": "-0.4%", "previous": "-2.3%" }, { "title": "BRC Retail Sales Monitor y/y", "country": "GBP", "date": "2025-07-14T19:01:00-04:00", "impact": "Low", "forecast": "1.2%", "previous": "0.6%" }, { "title": "Westpac Consumer Sentiment", "country": "AUD", "date": "2025-07-14T20:30:00-04:00", "impact": "Low", "forecast": "", "previous": "0.5%" }, { "title": "New Home Prices m/m", "country": "CNY", "date": "2025-07-14T21:30:00-04:00", "impact": "Low", "forecast": "", "previous": "-0.22%" }, { "title": "GDP q/y", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Medium", "forecast": "5.1%", "previous": "5.4%" }, { "title": "Industrial Production y/y", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Medium", "forecast": "5.6%", "previous": "5.8%" }, { "title": "Retail Sales y/y", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Medium", "forecast": "5.2%", "previous": "6.4%" }, { "title": "Fixed Asset Investment ytd/y", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Low", "forecast": "3.6%", "previous": "3.7%" }, { "title": "NBS Press Conference", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Unemployment Rate", "country": "CNY", "date": "2025-07-14T22:00:00-04:00", "impact": "Low", "forecast": "5.0%", "previous": "5.0%" }, { "title": "German ZEW Economic Sentiment", "country": "EUR", "date": "2025-07-15T05:00:00-04:00", "impact": "Medium", "forecast": "50.8", "previous": "47.5" }, { "title": "Industrial Production m/m", "country": "EUR", "date": "2025-07-15T05:00:00-04:00", "impact": "Low", "forecast": "1.1%", "previous": "-2.4%" }, { "title": "ZEW Economic Sentiment", "country": "EUR", "date": "2025-07-15T05:00:00-04:00", "impact": "Low", "forecast": "37.8", "previous": "35.3" }, { "title": "ECOFIN Meetings", "country": "EUR", "date": "2025-07-15T05:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "CPI m/m", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "0.1%", "previous": "0.6%" }, { "title": "Median CPI y/y", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "3.0%", "previous": "3.0%" }, { "title": "Trimmed CPI y/y", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "3.0%", "previous": "3.0%" }, { "title": "Common CPI y/y", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "Medium", "forecast": "2.7%", "previous": "2.6%" }, { "title": "Core CPI m/m", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "Low", "forecast": "", "previous": "0.6%" }, { "title": "Manufacturing Sales m/m", "country": "CAD", "date": "2025-07-15T08:30:00-04:00", "impact": "Low", "forecast": "-1.2%", "previous": "-2.8%" }, { "title": "Core CPI m/m", "country": "USD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "0.3%", "previous": "0.1%" }, { "title": "CPI m/m", "country": "USD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "0.3%", "previous": "0.1%" }, { "title": "CPI y/y", "country": "USD", "date": "2025-07-15T08:30:00-04:00", "impact": "High", "forecast": "2.6%", "previous": "2.4%" }, { "title": "Empire State Manufacturing Index", "country": "USD", "date": "2025-07-15T08:30:00-04:00", "impact": "Medium", "forecast": "-8.3", "previous": "-16.0" }, { "title": "FOMC Member Bowman Speaks", "country": "USD", "date": "2025-07-15T09:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "CB Leading Index m/m", "country": "AUD", "date": "2025-07-15T10:30:00-04:00", "impact": "Low", "forecast": "", "previous": "0.7%" }, { "title": "GDT Price Index", "country": "NZD", "date": "2025-07-15T10:49:00-04:00", "impact": "Low", "forecast": "", "previous": "-4.1%" }, { "title": "FOMC Member Barr Speaks", "country": "USD", "date": "2025-07-15T12:45:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Barkin Speaks", "country": "USD", "date": "2025-07-15T13:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Collins Speaks", "country": "USD", "date": "2025-07-15T14:45:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "BOE Gov Bailey Speaks", "country": "GBP", "date": "2025-07-15T16:00:00-04:00", "impact": "High", "forecast": "", "previous": "" }, { "title": "API Weekly Statistical Bulletin", "country": "USD", "date": "2025-07-15T16:30:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Logan Speaks", "country": "USD", "date": "2025-07-15T19:45:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "CPI y/y", "country": "GBP", "date": "2025-07-16T02:00:00-04:00", "impact": "High", "forecast": "3.4%", "previous": "3.4%" }, { "title": "Core CPI y/y", "country": "GBP", "date": "2025-07-16T02:00:00-04:00", "impact": "Low", "forecast": "3.5%", "previous": "3.5%" }, { "title": "RPI y/y", "country": "GBP", "date": "2025-07-16T02:00:00-04:00", "impact": "Low", "forecast": "4.3%", "previous": "4.3%" }, { "title": "HPI y/y", "country": "GBP", "date": "2025-07-16T04:30:00-04:00", "impact": "Low", "forecast": "3.2%", "previous": "3.5%" }, { "title": "Italian Trade Balance", "country": "EUR", "date": "2025-07-16T05:00:00-04:00", "impact": "Low", "forecast": "2.87B", "previous": "2.48B" }, { "title": "Trade Balance", "country": "EUR", "date": "2025-07-16T05:00:00-04:00", "impact": "Low", "forecast": "13.9B", "previous": "14.0B" }, { "title": "German 30-y Bond Auction", "country": "EUR", "date": "2025-07-16T05:33:00-04:00", "impact": "Low", "forecast": "", "previous": "2.99|2.2" }, { "title": "German Buba Monthly Report", "country": "EUR", "date": "2025-07-16T06:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Barkin Speaks", "country": "USD", "date": "2025-07-16T08:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Housing Starts", "country": "CAD", "date": "2025-07-16T08:15:00-04:00", "impact": "Low", "forecast": "262K", "previous": "280K" }, { "title": "Core PPI m/m", "country": "USD", "date": "2025-07-16T08:30:00-04:00", "impact": "High", "forecast": "0.2%", "previous": "0.1%" }, { "title": "PPI m/m", "country": "USD", "date": "2025-07-16T08:30:00-04:00", "impact": "High", "forecast": "0.2%", "previous": "0.1%" }, { "title": "Capacity Utilization Rate", "country": "USD", "date": "2025-07-16T09:15:00-04:00", "impact": "Low", "forecast": "77.4%", "previous": "77.4%" }, { "title": "FOMC Member Hammack Speaks", "country": "USD", "date": "2025-07-16T09:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Industrial Production m/m", "country": "USD", "date": "2025-07-16T09:15:00-04:00", "impact": "Low", "forecast": "0.1%", "previous": "-0.2%" }, { "title": "CB Leading Index m/m", "country": "GBP", "date": "2025-07-16T09:30:00-04:00", "impact": "Low", "forecast": "", "previous": "-0.4%" }, { "title": "FOMC Member Barr Speaks", "country": "USD", "date": "2025-07-16T10:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Crude Oil Inventories", "country": "USD", "date": "2025-07-16T10:30:00-04:00", "impact": "Low", "forecast": "-1.8M", "previous": "7.1M" }, { "title": "Beige Book", "country": "USD", "date": "2025-07-16T14:00:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Bostic Speaks", "country": "USD", "date": "2025-07-16T15:30:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Williams Speaks", "country": "USD", "date": "2025-07-16T18:30:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FPI m/m", "country": "NZD", "date": "2025-07-16T18:45:00-04:00", "impact": "Low", "forecast": "", "previous": "0.5%" }, { "title": "Trade Balance", "country": "JPY", "date": "2025-07-16T19:50:00-04:00", "impact": "Low", "forecast": "-0.26T", "previous": "-0.31T" }, { "title": "MI Inflation Expectations", "country": "AUD", "date": "2025-07-16T21:00:00-04:00", "impact": "Low", "forecast": "", "previous": "5.0%" }, { "title": "Employment Change", "country": "AUD", "date": "2025-07-16T21:30:00-04:00", "impact": "High", "forecast": "21.0K", "previous": "-2.5K" }, { "title": "Unemployment Rate", "country": "AUD", "date": "2025-07-16T21:30:00-04:00", "impact": "High", "forecast": "4.1%", "previous": "4.1%" }, { "title": "NAB Quarterly Business Confidence", "country": "AUD", "date": "2025-07-16T22:37:00-04:00", "impact": "Low", "forecast": "", "previous": "-4" }, { "title": "Trade Balance", "country": "CHF", "date": "2025-07-17T02:00:00-04:00", "impact": "Low", "forecast": "4.22B", "previous": "3.83B" }, { "title": "Average Earnings Index 3m/y", "country": "GBP", "date": "2025-07-17T02:00:00-04:00", "impact": "Medium", "forecast": "5.0%", "previous": "5.3%" }, { "title": "Claimant Count Change", "country": "GBP", "date": "2025-07-17T02:00:00-04:00", "impact": "Medium", "forecast": "17.9K", "previous": "33.1K" }, { "title": "Unemployment Rate", "country": "GBP", "date": "2025-07-17T02:00:00-04:00", "impact": "Low", "forecast": "4.6%", "previous": "4.6%" }, { "title": "Spanish 10-y Bond Auction", "country": "EUR", "date": "2025-07-17T04:42:00-04:00", "impact": "Low", "forecast": "", "previous": "3.16|1.9" }, { "title": "Final Core CPI y/y", "country": "EUR", "date": "2025-07-17T05:00:00-04:00", "impact": "Low", "forecast": "2.3%", "previous": "2.3%" }, { "title": "Final CPI y/y", "country": "EUR", "date": "2025-07-17T05:00:00-04:00", "impact": "Low", "forecast": "2.0%", "previous": "2.0%" }, { "title": "Foreign Securities Purchases", "country": "CAD", "date": "2025-07-17T08:30:00-04:00", "impact": "Low", "forecast": "-7.32B", "previous": "-9.36B" }, { "title": "Core Retail Sales m/m", "country": "USD", "date": "2025-07-17T08:30:00-04:00", "impact": "High", "forecast": "0.3%", "previous": "-0.3%" }, { "title": "Retail Sales m/m", "country": "USD", "date": "2025-07-17T08:30:00-04:00", "impact": "High", "forecast": "0.1%", "previous": "-0.9%" }, { "title": "Unemployment Claims", "country": "USD", "date": "2025-07-17T08:30:00-04:00", "impact": "High", "forecast": "233K", "previous": "227K" }, { "title": "Philly Fed Manufacturing Index", "country": "USD", "date": "2025-07-17T08:30:00-04:00", "impact": "Medium", "forecast": "-1.2", "previous": "-4.0" }, { "title": "Import Prices m/m", "country": "USD", "date": "2025-07-17T08:30:00-04:00", "impact": "Low", "forecast": "0.3%", "previous": "0.0%" }, { "title": "FOMC Member Kugler Speaks", "country": "USD", "date": "2025-07-17T09:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Business Inventories m/m", "country": "USD", "date": "2025-07-17T10:00:00-04:00", "impact": "Low", "forecast": "0.0%", "previous": "0.0%" }, { "title": "NAHB Housing Market Index", "country": "USD", "date": "2025-07-17T10:00:00-04:00", "impact": "Low", "forecast": "33", "previous": "32" }, { "title": "Natural Gas Storage", "country": "USD", "date": "2025-07-17T10:30:00-04:00", "impact": "Low", "forecast": "44B", "previous": "53B" }, { "title": "G20 Meetings", "country": "All", "date": "2025-07-17T11:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Daly Speaks", "country": "USD", "date": "2025-07-17T12:45:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "FOMC Member Cook Speaks", "country": "USD", "date": "2025-07-17T13:30:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "TIC Long-Term Purchases", "country": "USD", "date": "2025-07-17T16:00:00-04:00", "impact": "Low", "forecast": "48.3B", "previous": "-7.8B" }, { "title": "FOMC Member Waller Speaks", "country": "USD", "date": "2025-07-17T18:30:00-04:00", "impact": "Medium", "forecast": "", "previous": "" }, { "title": "National Core CPI y/y", "country": "JPY", "date": "2025-07-17T19:30:00-04:00", "impact": "Low", "forecast": "3.4%", "previous": "3.7%" }, { "title": "Credit Card Spending y/y", "country": "NZD", "date": "2025-07-17T23:00:00-04:00", "impact": "Low", "forecast": "", "previous": "2.2%" }, { "title": "German PPI m/m", "country": "EUR", "date": "2025-07-18T02:00:00-04:00", "impact": "Low", "forecast": "0.1%", "previous": "-0.2%" }, { "title": "Current Account", "country": "EUR", "date": "2025-07-18T04:00:00-04:00", "impact": "Low", "forecast": "34.8B", "previous": "19.8B" }, { "title": "German Buba President Nagel Speaks", "country": "EUR", "date": "2025-07-18T04:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }, { "title": "Building Permits", "country": "USD", "date": "2025-07-18T08:30:00-04:00", "impact": "Low", "forecast": "1.39M", "previous": "1.39M" }, { "title": "Housing Starts", "country": "USD", "date": "2025-07-18T08:30:00-04:00", "impact": "Low", "forecast": "1.29M", "previous": "1.26M" }, { "title": "Prelim UoM Consumer Sentiment", "country": "USD", "date": "2025-07-18T10:00:00-04:00", "impact": "Medium", "forecast": "61.4", "previous": "60.5" }, { "title": "Prelim UoM Inflation Expectations", "country": "USD", "date": "2025-07-18T10:00:00-04:00", "impact": "Medium", "forecast": "", "previous": "5.1%" }, { "title": "G20 Meetings", "country": "All", "date": "2025-07-18T11:15:00-04:00", "impact": "Low", "forecast": "", "previous": "" }];

        function processAndDisplayEconomicCalendarData(data) {
            const tableBody = document.getElementById('calendar-table').getElementsByTagName('tbody')[0];
            if (!tableBody) return;
            tableBody.innerHTML = '';

            const filteredData = data.filter(event => event.country === 'USD' && event.impact === 'High');
            const eventsByDate = filteredData.reduce((acc, event) => {
                const eventDate = new Date(event.date);
                const dateString = eventDate.toLocaleDateString('fr-FR');
                if (!acc[dateString]) acc[dateString] = [];
                acc[dateString].push(event);
                return acc;
            }, {});

            for (const dateString in eventsByDate) {
                eventsByDate[dateString].forEach((event, index) => {
                    const eventDate = new Date(event.date);
                    const row = tableBody.insertRow();
                    if (index === 0) {
                        const dateCell = row.insertCell();
                        dateCell.textContent = dateString;
                        dateCell.rowSpan = eventsByDate[dateString].length;
                    }
                    row.insertCell().textContent = `${eventDate.toLocaleTimeString('en-US', { timeZone: 'America/New_York' })} | ${eventDate.toLocaleTimeString('fr-FR', { timeZone: 'Europe/Paris' })}`;
                    row.insertCell().textContent = event.country;
                    const impactCell = row.insertCell();
                    if (event.impact === 'High') {
                        impactCell.innerHTML = `<span class="impact-high"><i class="fas fa-folder" style="color: red;"></i></span>`;
                    } else {
                        impactCell.textContent = event.impact;
                    }
                    row.insertCell().textContent = event.title;
                });
            }
        }

        function setEconomicCalendarWeekDates() {
            const weekDatesEl = document.getElementById('week-dates');
            if (!weekDatesEl) return;

            const today = new Date();
            const dayOfWeek = today.getDay();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            const options = { day: '2-digit', month: '2-digit', year: '2-digit' };
            const startDateStr = startOfWeek.toLocaleDateString('fr-FR', options);
            const endDateStr = endOfWeek.toLocaleDateString('fr-FR', options);

            weekDatesEl.textContent = `Données pour la semaine du: ${startDateStr} au ${endDateStr}`;
        }

        // Traductions
        const translations = {
            en: {
                title: "Prop Firm Performance Analyzer",
                settings: "Challenge Parameters",
                initialCapital: "Initial Capital ($)",
                targetProfit: "Target Profit ($)",
                consistencyPercent: "Consistency Rule (%)",
                minDayPercent: "Min % of Best Day",
                minProfitPerDay: "Min Profit/Day ($)",
                minTradingDays: "Min Trading Days",
                maxDrawdown: "Max Drawdown ($)",
                dailyLossLimit: "Daily Loss Limit ($)",
                dailyPnL: "Daily Performance",
                enterPnL: "Enter daily P&L ($)",
                add: "Add",
                results: "Performance Analysis",
                totalPnL: "Total P&L",
                bestDay: "Best Day",
                minRequiredDay: "Min Required/Day",
                optimalDailyPnL: "Optimal Daily Target",
                eligible: "✅ Challenge Passed!",
                notEligible: "❌ Challenge Failed",
                notEnoughDays: "Not enough trading days",
                bestDayExceeds: "Best day exceeds",
                daysBelowMin: "Some days below",
                daysBelowProfit: "Some days below min profit/day",
                drawdownViolated: "Drawdown limit violated",
                dailyLossViolated: "Daily loss limit violated",
                exportPDF: "Export Report",
                exportData: "Export Data",
                importData: "Import Data",
                language: "Language",
                accountBalance: "Account Balance",
                error: "An error occurred. Please check the console for details.",
                clearData: "Clear",
                performanceChart: "Performance Trend",
                profitDays: "Profit Days",
                lossDays: "Loss Days",
                avgProfit: "Avg Profit/Day",
                avgLoss: "Avg Loss/Day",
                winRate: "Win Rate",
                maxConsecutiveWins: "Max Consecutive Wins",
                maxConsecutiveLosses: "Max Consecutive Losses",
                ignoreConsistency: "Ignore Consistency/Min%/Min Profit rules",
                helpText: "For any rule you want to ignore, enter 0 in the corresponding field. Only fields with a value greater than 0 will be enforced."
            },
            fr: {
                title: "Analyseur de Performance pour Prop Firms",
                settings: "Paramètres du Challenge",
                initialCapital: "Capital Initial ($)",
                targetProfit: "Objectif de Profit ($)",
                consistencyPercent: "Règle de Cohérence (%)",
                minDayPercent: "Min % du Meilleur Jour",
                minProfitPerDay: "Profit Min/Jour ($)",
                minTradingDays: "Jours de Trading Min",
                maxDrawdown: "Drawdown Max ($)",
                dailyLossLimit: "Limite de Perte Quotidienne ($)",
                dailyPnL: "Performance Quotidienne",
                enterPnL: "Entrez le P&L quotidien ($)",
                add: "Ajouter",
                results: "Analyse de Performance",
                totalPnL: "P&L Total",
                bestDay: "Meilleur Jour",
                minRequiredDay: "Min Requis/Jour",
                optimalDailyPnL: "Objectif Quotidien Optimal",
                eligible: "✅ Challenge Réussi !",
                notEligible: "❌ Challenge Échoué",
                notEnoughDays: "Pas assez de jours de trading",
                bestDayExceeds: "Meilleur jour dépasse",
                daysBelowMin: "Certains jours sous",
                daysBelowProfit: "Certains jours sous le profit min/jour",
                drawdownViolated: "Limite de drawdown violée",
                dailyLossViolated: "Limite de perte quotidienne violée",
                exportPDF: "Exporter Rapport",
                exportData: "Exporter les données",
                importData: "Importer les données",
                language: "Langue",
                accountBalance: "Solde du Compte",
                error: "Une erreur s'est produite. Veuillez vérifier la console pour plus de détails.",
                clearData: "Effacer",
                performanceChart: "Tendance de Performance",
                profitDays: "Jours de Profit",
                lossDays: "Jours de Perte",
                avgProfit: "Moyenne Profit/Jour",
                avgLoss: "Moyenne Perte/Jour",
                winRate: "Taux de Réussite",
                maxConsecutiveWins: "Gains Consécutifs Max",
                maxConsecutiveLosses: "Pertes Consécutives Max",
                ignoreConsistency: "Ignorer les règles de Cohérence/Min%/Profit Min",
                helpText: "Pour ignorer une règle, entrez 0 dans le champ correspondant. Seules les valeurs supérieures à 0 seront prises en compte."
            }
        };

        // Fonction pour calculer les statistiques avancées
        function calculateAdvancedStats(dailyPnLs) {
            const stats = {
                profitDays: 0,
                lossDays: 0,
                totalProfit: 0,
                totalLoss: 0,
                winStreak: 0,
                loseStreak: 0,
                maxWinStreak: 0,
                maxLoseStreak: 0,
                currentStreak: 0,
                previousType: null
            };

            dailyPnLs.forEach(pnL => {
                if (pnL >= 0) {
                    stats.profitDays++;
                    stats.totalProfit += pnL;

                    if (stats.previousType === 'win' || stats.previousType === null) {
                        stats.winStreak++;
                    } else {
                        stats.winStreak = 1;
                    }
                    stats.maxWinStreak = Math.max(stats.maxWinStreak, stats.winStreak);
                    stats.previousType = 'win';
                } else {
                    stats.lossDays++;
                    stats.totalLoss += Math.abs(pnL);

                    if (stats.previousType === 'loss' || stats.previousType === null) {
                        stats.loseStreak++;
                    } else {
                        stats.loseStreak = 1;
                    }
                    stats.maxLoseStreak = Math.max(stats.maxLoseStreak, stats.loseStreak);
                    stats.previousType = 'loss';
                }
            });

            return {
                profitDays: stats.profitDays,
                lossDays: stats.lossDays,
                avgProfit: stats.profitDays > 0 ? (stats.totalProfit / stats.profitDays) : 0,
                avgLoss: stats.lossDays > 0 ? (stats.totalLoss / stats.lossDays) : 0,
                winRate: dailyPnLs.length > 0 ? (stats.profitDays / dailyPnLs.length * 100) : 0,
                maxConsecutiveWins: stats.maxWinStreak,
                maxConsecutiveLosses: stats.maxLoseStreak
            };
        }

        // Composant principal
        class ConsistencyApp {
            constructor() {
                this.state = {
                    language: 'fr',
                    error: null,
                    initialCapital: localStorage.getItem('initialCapital') || 50000,
                    targetProfit: localStorage.getItem('targetProfit') || 10000,
                    consistencyPercent: localStorage.getItem('consistencyPercent') || 40,
                    minDayPercent: localStorage.getItem('minDayPercent') || 23,
                    minProfitPerDay: localStorage.getItem('minProfitPerDay') || 200,
                    minTradingDays: localStorage.getItem('minTradingDays') || 10,
                    maxDrawdown: localStorage.getItem('maxDrawdown') || 2000,
                    dailyLossLimit: localStorage.getItem('dailyLossLimit') || 1000,
                    dailyPnLs: JSON.parse(localStorage.getItem('dailyPnLs')) || [],
                    newPnL: ''
                };
                this.chartInstance = null;
                this.t = translations[this.state.language];
                this.init();
            }

            init() {
                this.render();
                this.initChart();
                this.bindEvents();
            }

            saveState() {
                try {
                    localStorage.setItem('language', this.state.language);
                    localStorage.setItem('initialCapital', this.state.initialCapital);
                    localStorage.setItem('targetProfit', this.state.targetProfit);
                    localStorage.setItem('consistencyPercent', this.state.consistencyPercent);
                    localStorage.setItem('minDayPercent', this.state.minDayPercent);
                    localStorage.setItem('minProfitPerDay', this.state.minProfitPerDay);
                    localStorage.setItem('minTradingDays', this.state.minTradingDays);
                    localStorage.setItem('maxDrawdown', this.state.maxDrawdown);
                    localStorage.setItem('dailyLossLimit', this.state.dailyLossLimit);
                    localStorage.setItem('dailyPnLs', JSON.stringify(this.state.dailyPnLs));
                } catch (err) {
                    console.error('Failed to save to localStorage:', err);
                    this.setState({ error: this.t.error });
                }
            }

            setState(newState) {
                this.state = { ...this.state, ...newState };
                this.t = translations[this.state.language];
                this.saveState();
                this.render();
                setTimeout(() => {
                    if (!this.chartInstance && this.state.dailyPnLs.length > 0) {
                        this.initChart();
                    } else if (this.chartInstance) {
                        this.updateChart();
                    }
                }, 0);
            }

            calculateResults() {
                const {
                    dailyPnLs,
                    initialCapital,
                    targetProfit,
                    consistencyPercent,
                    minDayPercent,
                    minProfitPerDay,
                    minTradingDays,
                    maxDrawdown,
                    dailyLossLimit
                } = this.state;

                const totalPnL = dailyPnLs.reduce((sum, pnL) => sum + Number(pnL), 0);
                const maxDayPnL = dailyPnLs.length > 0 ? Math.max(...dailyPnLs) : 0;
                const maxDayPercent = totalPnL > 0 ? (maxDayPnL / totalPnL) * 100 : 0;
                const minRequiredPerDay = (minDayPercent / 100) * maxDayPnL;
                const accountBalance = Number(initialCapital) + totalPnL;
                const drawdownViolated = maxDrawdown > 0 ? accountBalance < (initialCapital - maxDrawdown) : false;
                const dailyLossViolated = dailyLossLimit > 0 ? dailyPnLs.some(pnL => pnL < -dailyLossLimit) : false;
                // Only enforce rules if their value is >0
                const checkConsistency = consistencyPercent > 0 ? maxDayPercent <= consistencyPercent : true;
                const checkMinDay = minDayPercent > 0 ? dailyPnLs.filter(pnL => pnL > 0).every(pnL => pnL >= minRequiredPerDay) : true;
                const checkMinProfit = minProfitPerDay > 0 ? dailyPnLs.filter(pnL => pnL > 0).every(pnL => pnL >= minProfitPerDay) : true;
                const isEligible = dailyPnLs.length >= minTradingDays &&
                    checkConsistency &&
                    checkMinDay &&
                    checkMinProfit &&
                    !drawdownViolated &&
                    !dailyLossViolated;
                const targetDiff = totalPnL < targetProfit ? targetProfit - totalPnL : 0;

                const optimalDailyPnL = dailyPnLs.length > 0
                    ? (targetProfit / Math.max(dailyPnLs.length, minTradingDays)) * (100 / (100 - (consistencyPercent > 0 ? consistencyPercent : 0)))
                    : targetProfit / minTradingDays;

                const advancedStats = calculateAdvancedStats(dailyPnLs);

                return {
                    totalPnL,
                    maxDayPnL,
                    maxDayPercent,
                    minRequiredPerDay,
                    accountBalance,
                    drawdownViolated,
                    dailyLossViolated,
                    isEligible,
                    optimalDailyPnL,
                    targetDiff,
                    checkConsistency,
                    checkMinDay,
                    checkMinProfit,
                    ...advancedStats
                };
            }

            addPnL() {
                try {
                    // Always get the latest value from the input field
                    const input = document.getElementById('newPnL');
                    const value = input ? parseFloat(input.value) : parseFloat(this.state.newPnL);
                    if (!isNaN(value)) {
                        this.setState({
                            dailyPnLs: [...this.state.dailyPnLs, value],
                            newPnL: ''
                        });
                    }
                } catch (err) {
                    console.error('Failed to add P&L:', err);
                    this.setState({ error: this.t.error });
                }
            }

            removePnL(index) {
                try {
                    this.setState({
                        dailyPnLs: this.state.dailyPnLs.filter((_, i) => i !== index)
                    });
                } catch (err) {
                    console.error('Failed to remove P&L:', err);
                    this.setState({ error: this.t.error });
                }
            }

            clearAllData() {
                if (confirm(this.state.language === 'fr' ? "Êtes-vous sûr de vouloir tout effacer ?" : "Are you sure you want to clear all data?")) {
                    this.setState({
                        dailyPnLs: [],
                        newPnL: ''
                    });
                }
            }

            initChart() {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                this.chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: this.state.dailyPnLs.map((_, i) => `Day ${i + 1}`),
                        datasets: [
                            {
                                label: this.t.performanceChart,
                                data: this.state.dailyPnLs,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16,185,129,0.15)', // always green fill
                                borderWidth: 2,
                                tension: 0.3,
                                fill: true,
                                pointBackgroundColor: this.state.dailyPnLs.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444'),
                                pointBorderColor: '#fff',
                                pointRadius: 4,
                                pointHoverRadius: 6
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: '#1e293b',
                                titleColor: '#f8fafc',
                                bodyColor: '#e2e8f0',
                                borderColor: '#334155',
                                borderWidth: 1,
                                callbacks: {
                                    label: function (context) {
                                        let label = '';
                                        if (context.parsed.y !== null) {
                                            label += (context.parsed.y >= 0 ? '+' : '') + '$ ' + context.parsed.y.toFixed(2);
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: { color: '#94a3b8' },
                                title: { display: true, text: 'Trading Days', color: '#94a3b8' }
                            },
                            y: {
                                grid: { color: 'rgba(255, 255, 255, 0.05)' },
                                ticks: {
                                    color: '#94a3b8',
                                    callback: function (value) { return '$ ' + value; }
                                },
                                title: { display: true, text: 'P&L ($)', color: '#94a3b8' }
                            }
                        },
                        interaction: { mode: 'nearest', axis: 'x', intersect: false }
                    }
                });
            }

            updateChart() {
                if (!this.chartInstance) return;
                const labels = this.state.dailyPnLs.map((_, i) => `Day ${i + 1}`);
                this.chartInstance.data.labels = labels;
                this.chartInstance.data.datasets[0].data = this.state.dailyPnLs;
                this.chartInstance.data.datasets[0].pointBackgroundColor = this.state.dailyPnLs.map(pnl => pnl >= 0 ? '#10b981' : '#ef4444');
                this.chartInstance.update();
            }

            bindEvents() {
                // Attach listeners directly after each render
                const addBtn = document.getElementById('addPnL');
                const clearBtn = document.getElementById('clearData');
                const newPnLInput = document.getElementById('newPnL');
                const langSelect = document.getElementById('language');
                const helpBtn = document.getElementById('helpBtn');
                const helpModal = document.getElementById('helpModal');
                const closeHelpModal = document.getElementById('closeHelpModal');
                const removeBtns = document.querySelectorAll('.remove-pnl');
                const inputIds = [
                    'initialCapital', 'targetProfit', 'consistencyPercent', 'minDayPercent',
                    'minProfitPerDay', 'minTradingDays', 'maxDrawdown', 'dailyLossLimit'
                ];

                if (addBtn) addBtn.onclick = () => this.addPnL();
                if (clearBtn) clearBtn.onclick = () => this.clearAllData();
                if (langSelect) langSelect.onchange = (e) => this.setState({ language: e.target.value });
                if (helpBtn && helpModal) {
                    helpBtn.onclick = () => {
                        const content = this.state.language === 'fr' ? `
                  <p><b>À propos :</b><br>Cette application web vous aide à vérifier si vos performances de trading respectent les règles de consistance et de gestion du risque imposées par les prop firms. Elle permet de simuler, suivre et analyser vos résultats quotidiens pour maximiser vos chances de réussir un challenge ou d’obtenir un payout.</p>
                  <p><b>Instructions :</b></p>
                  <ul>
                    <li>1. Renseignez les paramètres du challenge (capital initial, objectif, drawdown, etc.).</li>
                    <li>2. Ajoutez chaque jour votre P&L (profit ou perte) dans le champ prévu puis cliquez sur “Ajouter Jour”.</li>
                    <li>3. Consultez vos statistiques, l’éligibilité et le graphique de performance.</li>
                    <li>4. Vous pouvez supprimer un jour, effacer toutes les données, exporter vos données au format JSON ou importer un fichier JSON pour restaurer vos données.</li>
                    <li>5. Changez la langue avec le sélecteur en haut à droite.</li>
                  </ul>
                  <p><b>Import/Export :</b><br>Utilisez “Exporter les données” pour sauvegarder vos paramètres et performances au format JSON. Utilisez “Importer les données” pour charger un fichier JSON précédemment exporté et restaurer votre session.</p>
                  <p><b>Stockage :</b><br>Vos données sont enregistrées localement dans votre navigateur (aucune transmission externe).</p>
                ` : `
                  <p><b>About:</b><br>This web app helps you check if your trading performance meets the consistency and risk management rules required by prop firms. It lets you simulate, track, and analyze your daily results to maximize your chances of passing a challenge or getting a payout.</p>
                  <p><b>Instructions:</b></p>
                  <ul>
                    <li>1. Fill in the challenge parameters (initial capital, target, drawdown, etc.).</li>
                    <li>2. Add your daily P&L (profit or loss) in the input field and click “Add Day”.</li>
                    <li>3. Review your stats, eligibility, and the performance chart.</li>
                    <li>4. You can remove a day, clear all data, export your data as JSON, or import a JSON file to restore your session.</li>
                    <li>5. Switch language using the selector at the top right.</li>
                  </ul>
                  <p><b>Import/Export:</b><br>Use “Export Data” to save your settings and performance as a JSON file. Use “Import Data” to load a previously exported JSON file and restore your session.</p>
                  <p><b>Data Storage:</b><br>Your data is saved locally in your browser (never sent anywhere).</p>
                `;
                        document.getElementById('helpModalContent').innerHTML = content;
                        helpModal.style.display = 'flex';
                    };
                }
                if (closeHelpModal && helpModal) closeHelpModal.onclick = () => { helpModal.style.display = 'none'; };
                if (helpModal) helpModal.onclick = (e) => { if (e.target === helpModal) helpModal.style.display = 'none'; };
                if (newPnLInput) {
                    // Only update state on blur or Enter, not on every input
                    newPnLInput.oninput = null;
                    newPnLInput.onblur = (e) => this.setState({ newPnL: e.target.value });
                    newPnLInput.onkeypress = (e) => { if (e.key === 'Enter') this.addPnL(); };
                }
                inputIds.forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.onchange = (e) => this.setState({ [id]: e.target.value });
                });
                removeBtns.forEach(btn => {
                    btn.onclick = (e) => {
                        const idx = parseInt(btn.dataset.index);
                        this.removePnL(idx);
                    };
                });

                // Add import/export event listeners
                const importBtn = document.getElementById('importDataBtn');
                const importInput = document.getElementById('importData');
                const exportDataBtn = document.getElementById('exportDataBtn');
                if (importBtn && importInput) {
                    importBtn.onclick = () => importInput.click();
                    importInput.onchange = (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const data = JSON.parse(event.target.result);
                                this.setState({ ...data });
                            } catch (err) {
                                alert('Invalid JSON file.');
                            }
                        };
                        reader.readAsText(file);
                    };
                }
                if (exportDataBtn) {
                    exportDataBtn.onclick = () => {
                        const data = {
                            language: this.state.language,
                            initialCapital: this.state.initialCapital,
                            targetProfit: this.state.targetProfit,
                            consistencyPercent: this.state.consistencyPercent,
                            minDayPercent: this.state.minDayPercent,
                            minProfitPerDay: this.state.minProfitPerDay,
                            minTradingDays: this.state.minTradingDays,
                            maxDrawdown: this.state.maxDrawdown,
                            dailyLossLimit: this.state.dailyLossLimit,
                            dailyPnLs: this.state.dailyPnLs
                        };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'propfirm_data.json';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    };
                }

                // Add import/export event listeners for footer
                const importBtnFooter = document.getElementById('importDataBtnFooter');
                const importInputFooter = document.getElementById('importDataFooter');
                const exportDataBtnFooter = document.getElementById('exportDataBtnFooter');
                if (importBtnFooter && importInputFooter) {
                    importBtnFooter.onclick = () => importInputFooter.click();
                    importInputFooter.onchange = (e) => {
                        const file = e.target.files[0];
                        if (!file) return;
                        const reader = new FileReader();
                        reader.onload = (event) => {
                            try {
                                const data = JSON.parse(event.target.result);
                                this.setState({ ...data });
                            } catch (err) {
                                alert('Invalid JSON file.');
                            }
                        };
                        reader.readAsText(file);
                    };
                }
                if (exportDataBtnFooter) {
                    exportDataBtnFooter.onclick = () => {
                        const data = {
                            language: this.state.language,
                            initialCapital: this.state.initialCapital,
                            targetProfit: this.state.targetProfit,
                            consistencyPercent: this.state.consistencyPercent,
                            minDayPercent: this.state.minDayPercent,
                            minProfitPerDay: this.state.minProfitPerDay,
                            minTradingDays: this.state.minTradingDays,
                            maxDrawdown: this.state.maxDrawdown,
                            dailyLossLimit: this.state.dailyLossLimit,
                            dailyPnLs: this.state.dailyPnLs
                        };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'propfirm_data.json';
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                    };
                }
            }

            render() {
                const { t } = this;
                const results = this.calculateResults();

                document.getElementById('consistency-app').innerHTML = `
              <div class="space-y-8">
                <!-- Header -->
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                  <div class="flex flex-col">
                    <h1 class="text-3xl font-bold text-accent-blue">
                      <i class="fas fa-chart-line mr-2"></i>${t.title}
                    </h1>
                    <p class="subtitle-artistic">${this.state.language === 'fr' ? 'Simulez et analysez vos performances de trading pour réussir n’importe quel challenge prop firm.' : 'Simulate and analyze your trading performance to pass any prop firm challenge.'}</p>
                  </div>
                </div>
                
                ${this.state.error ? `
                  <div class="bg-accent-red text-white p-4 rounded-lg">
                    <i class="fas fa-exclamation-circle mr-2"></i>${this.state.error}
                  </div>
                ` : ''}
                
                <!-- Settings Card -->
                <div class="card rounded-xl p-6 shadow-lg slide-in">
                  <h2 class="text-xl font-semibold mb-4 flex items-center text-accent-blue">
                    <i class="fas fa-cog mr-2"></i>${t.settings}
                  </h2>
                  
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                    <!-- Fields -->
                    <div>
                      <label for="initialCapital" class="block text-sm font-medium text-text-secondary mb-1">${t.initialCapital}</label>
                      <input type="number" id="initialCapital" value="${this.state.initialCapital}" class="form-input w-full" min="0"/>
                    </div>
                    <div>
                      <label for="targetProfit" class="block text-sm font-medium text-text-secondary mb-1">${t.targetProfit}</label>
                      <input type="number" id="targetProfit" value="${this.state.targetProfit}" class="form-input w-full" min="0"/>
                    </div>
                    <div>
                      <label for="consistencyPercent" class="block text-sm font-medium text-text-secondary mb-1">${t.consistencyPercent}</label>
                      <input type="number" id="consistencyPercent" value="${this.state.consistencyPercent}" class="form-input w-full" min="0" max="100"/>
                    </div>
                    <div>
                      <label for="minDayPercent" class="block text-sm font-medium text-text-secondary mb-1">${t.minDayPercent}</label>
                      <input type="number" id="minDayPercent" value="${this.state.minDayPercent}" class="form-input w-full" min="0" max="100"/>
                    </div>
                    <div>
                      <label for="minProfitPerDay" class="block text-sm font-medium text-text-secondary mb-1">${t.minProfitPerDay}</label>
                      <input type="number" id="minProfitPerDay" value="${this.state.minProfitPerDay}" class="form-input w-full" min="0"/>
                    </div>
                    <div>
                      <label for="minTradingDays" class="block text-sm font-medium text-text-secondary mb-1">${t.minTradingDays}</label>
                      <input type="number" id="minTradingDays" value="${this.state.minTradingDays}" class="form-input w-full" min="1"/>
                    </div>
                    <div>
                      <label for="maxDrawdown" class="block text-sm font-medium text-text-secondary mb-1">${t.maxDrawdown}</label>
                      <input type="number" id="maxDrawdown" value="${this.state.maxDrawdown}" class="form-input w-full" min="0"/>
                    </div>
                    <div>
                      <label for="dailyLossLimit" class="block text-sm font-medium text-text-secondary mb-1">${t.dailyLossLimit}</label>
                      <input type="number" id="dailyLossLimit" value="${this.state.dailyLossLimit}" class="form-input w-full" min="0"/>
                    </div>
                  </div>

                  <!-- Help Text -->
                  <div class="col-span-full text-xs text-text-secondary mt-2">
                    ${t.helpText}
                  </div>
                </div>
                
                <!-- Daily P&L Input -->
                <div class="card rounded-xl p-6 shadow-lg slide-in">
                  <h2 class="text-xl font-semibold mb-4 flex items-center text-accent-green">
                    <i class="fas fa-calendar-day mr-2"></i>${t.dailyPnL}
                  </h2>
                  
                  <div class="flex flex-col sm:flex-row gap-3 mb-4">
                    <div class="relative flex-1">
                      <input type="number" id="newPnL" value="${this.state.newPnL}" placeholder="${t.enterPnL.replace(/\$/g, '').trim()}" class="form-input w-full"/>
                    </div>
                    <button id="addPnL" class="btn-primary flex items-center justify-center px-6 py-2 rounded-lg transition">
                      <i class="fas fa-plus mr-2"></i>${t.add}
                    </button>
                    <button id="clearData" class="btn-danger flex items-center justify-center px-6 py-2 rounded-lg transition">
                      <i class="fas fa-trash-alt mr-2"></i>${t.clearData}
                    </button>
                  </div>
                  
                  <div class="max-h-60 overflow-y-auto scrollbar-hide border border-border-color rounded-lg">
                    ${this.state.dailyPnLs.length > 0 ? `
                      <table class="min-w-full divide-y divide-border-color">
                        <thead class="bg-bg-dark">
                          <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">Day</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-text-secondary uppercase tracking-wider">P&L</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-text-secondary uppercase tracking-wider">Actions</th>
                          </tr>
                        </thead>
                        <tbody class="bg-bg-light divide-y divide-border-color">
                          ${this.state.dailyPnLs.map((pnL, index) => `
                            <tr class="${pnL >= 0 ? 'text-accent-green' : 'text-accent-red'}">
                              <td class="px-4 py-3 whitespace-nowrap">Day ${index + 1}</td>
                              <td class="px-4 py-3 whitespace-nowrap">${pnL !== 0 ? '$&nbsp;&nbsp;' : ''}${pnL.toFixed(2)}</td>
                              <td class="px-4 py-3 whitespace-nowrap text-right">
                                <button data-index="${index}" class="remove-pnl text-text-secondary hover:text-accent-red transition">
                                  <i class="fas fa-times"></i>
                                </button>
                              </td>
                            </tr>
                          `).join('')}
                        </tbody>
                      </table>
                    ` : `
                      <div class="p-8 text-center text-text-secondary">
                        <i class="fas fa-inbox text-4xl mb-2"></i>
                        <p>No trading days added yet</p>
                      </div>
                    `}
                  </div>
                </div>
                
                <!-- Performance Chart -->
                <div class="card rounded-xl p-6 shadow-lg slide-in">
                  <h2 class="text-xl font-semibold mb-4 flex items-center text-accent-yellow">
                    <i class="fas fa-chart-area mr-2"></i>${t.performanceChart}
                  </h2>
                  <div class="h-80 overflow-x-auto">
                    <canvas id="performanceChart"></canvas>
                  </div>
                </div>
                
                <!-- Results Card -->
                <div class="card rounded-xl p-6 shadow-lg slide-in">
                  <h2 class="text-xl font-semibold mb-4 flex items-center text-accent-yellow">
                    <i class="fas fa-chart-pie mr-2"></i>${t.results}
                  </h2>
                  
                  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Basic Stats -->
                    <div class="space-y-4">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.totalPnL}</p>
                          <p class="text-2xl font-semibold ${results.totalPnL >= 0 ? 'text-accent-green' : 'text-accent-red'}">
                            ${results.totalPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.totalPnL.toFixed(2)}
                          </p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.accountBalance}</p>
                          <p class="text-2xl font-semibold ${results.accountBalance >= this.state.initialCapital ? 'text-accent-green' : 'text-accent-red'}">
                            ${results.accountBalance !== 0 ? '$&nbsp;&nbsp;' : ''}${results.accountBalance.toFixed(2)}
                          </p>
                        </div>
                      </div>
                      
                      <div class="grid grid-cols-2 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.bestDay}</p>
                          <p class="text-xl font-semibold text-accent-green">
                            ${results.maxDayPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.maxDayPnL.toFixed(2)} <span class="text-sm">(${results.maxDayPercent.toFixed(2)}%)</span>
                          </p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.minRequiredDay}</p>
                          <p class="text-xl font-semibold text-accent-blue">
                            ${results.minRequiredPerDay !== 0 ? '$&nbsp;&nbsp;' : ''}${results.minRequiredPerDay.toFixed(2)}
                          </p>
                        </div>
                      </div>
                      
                      <div class="bg-bg-dark p-4 rounded-lg">
                        <p class="text-sm text-text-secondary">${t.optimalDailyPnL}</p>
                        <p class="text-xl font-semibold text-accent-yellow">
                          ${results.optimalDailyPnL !== 0 ? '$&nbsp;&nbsp;' : ''}${results.optimalDailyPnL.toFixed(2)}
                        </p>
                      </div>
                      
                      <div class="bg-bg-dark p-4 rounded-lg">
                        <p class="text-sm text-text-secondary">Challenge Status</p>
                        ${this.state.dailyPnLs.length === 0 ? `
                          <p class="text-base text-text-secondary italic">Awaiting trading data…</p>
                        ` :
                        !results.isEligible && this.state.dailyPnLs.length < this.state.minTradingDays && results.checkConsistency && results.checkMinDay && results.checkMinProfit && !results.drawdownViolated && !results.dailyLossViolated ? `
                            <div class="mb-2">
                              <div class="w-full bg-bg-light rounded-full h-3 overflow-hidden">
                                <div class="bg-gradient-to-r from-blue-500 via-emerald-400 to-yellow-300 h-3 rounded-full animate-pulse" style="width: ${(this.state.dailyPnLs.length / this.state.minTradingDays) * 100}%"></div>
                              </div>
                              <p class="mt-2 text-accent-green font-semibold">Keep going! ${this.state.dailyPnLs.length} of ${this.state.minTradingDays} trading days completed.</p>
                              <p class="text-xs text-text-secondary">Stay consistent and reach the minimum to be eligible for payout.</p>
                            </div>
                          ` :
                            results.isEligible ? `
                            <p class="text-xl font-semibold text-accent-green">✅ Eligible for Payout</p>
                            ${results.targetDiff > 0 ? `<div class="mt-2 text-sm text-accent-yellow"><i class="fas fa-exclamation-circle mr-1"></i>Target not reached: $&nbsp;&nbsp;${results.targetDiff.toFixed(2)} left</div>` : ''}
                          ` :
                                `<p class="text-xl font-semibold text-accent-red">❌ Challenge Failed</p>`
                    }
                        ${!results.isEligible && this.state.dailyPnLs.length > 0 ? `
                          <div class="mt-2 text-sm text-text-primary space-y-1">
                            ${this.state.dailyPnLs.length < this.state.minTradingDays ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.notEnoughDays} (${this.state.dailyPnLs.length}/${this.state.minTradingDays})</p>
                            ` : ''}
                            ${results.maxDayPercent > this.state.consistencyPercent ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.bestDayExceeds} ${this.state.consistencyPercent}% (${results.maxDayPercent.toFixed(2)}%)</p>
                            ` : ''}
                            ${this.state.dailyPnLs.some(pnL => pnL < results.minRequiredPerDay) ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.daysBelowMin} ${this.state.minDayPercent}% of best day ($&nbsp;&nbsp;${results.minRequiredPerDay.toFixed(2)})</p>
                            ` : ''}
                            ${this.state.dailyPnLs.some(pnL => pnL < this.state.minProfitPerDay) ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.daysBelowProfit} ($&nbsp;&nbsp;${this.state.minProfitPerDay})</p>
                            ` : ''}
                            ${results.drawdownViolated ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.drawdownViolated} ($&nbsp;&nbsp;${this.state.maxDrawdown})</p>
                            ` : ''}
                            ${results.dailyLossViolated ? `
                              <p><i class="fas fa-times-circle text-accent-red mr-1"></i> ${t.dailyLossViolated} ($&nbsp;&nbsp;${this.state.dailyLossLimit})</p>
                            ` : ''}
                          </div>
                        ` : ''}
                      </div>
                    </div>
                    
                    <!-- Advanced Stats -->
                    <div class="space-y-4">
                      <div class="grid grid-cols-2 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.profitDays}</p>
                          <p class="text-2xl font-semibold text-accent-green">
                            ${results.profitDays}
                          </p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.lossDays}</p>
                          <p class="text-2xl font-semibold text-accent-red">
                            ${results.lossDays}
                          </p>
                        </div>
                      </div>
                      
                      <div class="grid grid-cols-2 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.avgProfit}</p>
                          <p class="text-xl font-semibold text-accent-green">
                            ${results.avgProfit !== 0 ? '$&nbsp;&nbsp;' : ''}${results.avgProfit.toFixed(2)}
                          </p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.avgLoss}</p>
                          <p class="text-xl font-semibold text-accent-red">
                            ${results.avgLoss !== 0 ? '$&nbsp;&nbsp;' : ''}${results.avgLoss.toFixed(2)}
                          </p>
                        </div>
                      </div>
                      
                      <div class="bg-bg-dark p-4 rounded-lg">
                        <p class="text-sm text-text-secondary">${t.winRate}</p>
                        <div class="mt-1">
                          <div class="w-full bg-bg-light rounded-full h-2.5">
                            <div class="bg-gradient-to-r from-blue-500 to-emerald-400 h-2.5 rounded-full" style="width: ${results.winRate}%"></div>
                          </div>
                          <p class="text-xl font-semibold text-accent-blue mt-1">
                            ${results.winRate.toFixed(2)}%
                          </p>
                        </div>
                      </div>
                      
                      <div class="grid grid-cols-2 gap-4">
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.maxConsecutiveWins}</p>
                          <p class="text-xl font-semibold text-accent-green">
                            ${results.maxConsecutiveWins}
                          </p>
                        </div>
                        <div class="bg-bg-dark p-4 rounded-lg">
                          <p class="text-sm text-text-secondary">${t.maxConsecutiveLosses}</p>
                          <p class="text-xl font-semibold text-accent-red">
                            ${results.maxConsecutiveLosses}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            `;

                // Destroy and re-initialize the chart after each render
                if (this.chartInstance) {
                    this.chartInstance.destroy();
                    this.chartInstance = null;
                }
                if (this.state.dailyPnLs.length > 0) {
                    this.initChart();
                }
                this.bindEvents();
            }
        }

        // Application principale
        class TradingJournal {
            constructor() {
                this.currentDate = new Date();
                this.selectedDateForEntry = null;
                this.tradingTips = [
                    "La patience est la clé. Attendez que votre setup se présente, ne le forcez pas.",
                    "Ne risquez jamais plus que ce que vous êtes prêt à perdre sur un seul trade.",
                    "Le plan de trading est votre feuille de route. Suivez-le à la lettre.",
                    "L'analyse post-trade est plus importante que l'analyse pré-trade. Apprenez de vos erreurs et de vos succès.",
                    "Le marché est fractal. Les mêmes schémas se répètent sur toutes les unités de temps.",
                    "La gestion du risque est la seule chose que vous pouvez contrôler à 100%.",
                    "N'ayez pas peur de prendre une perte. C'est une partie inévitable du trading.",
                    "Un trade gagnant ne fait pas de vous un génie, un trade perdant ne fait pas de vous un échec. Restez humble.",
                    "La psychologie est 90% du jeu. Maîtrisez vos émotions.",
                    "Toujours commencer par analyser le contexte du marché avant d'entrer en position. Une analyse technique fiable doit être à la fois confirmée et comporter un niveau clair d'invalidation."
                ];
                this.tickerData = {
                    'NQ': { tickValue: 5, tickSize: 0.25, name: 'NASDAQ-100 E-mini' },
                    'MNQ': { tickValue: 0.5, tickSize: 0.25, name: 'Micro NASDAQ-100' },
                    'GU': { tickValue: 10, tickSize: 0.0001, name: 'GBP/USD & EUR/USD' }, // 1 pip = 0.0001, 1 pip value = 10$
                    'US100': { tickValue: 0.1, tickSize: 0.01, name: 'US Tech 100' } // 1 tick = 0.01 point, 1 tick value = 0.1$
                };
                this.selectedTicker = 'GU';
                this.init();
            }

            init() {
                this.initializeDOM();
                this.setupEventListeners();
                this.renderCalendar();
                this.showRandomTip();
                this.showNotification('Application chargée avec succès!', 'success');
            }

            showRandomTip() {
                const tipContainer = document.querySelector('#daily-tip-section p');
                if (tipContainer) {
                    const randomIndex = Math.floor(Math.random() * this.tradingTips.length);
                    tipContainer.textContent = this.tradingTips[randomIndex];
                }
            }

            initializeDOM() {
                // Éléments DOM principaux
                this.calendarContainer = document.getElementById('calendar-container');
                this.currentMonthYear = document.getElementById('currentMonthYear');
                this.formSection = document.getElementById('form-section');
                this.journalForm = document.getElementById('journal-form');
                this.entryDateEl = document.getElementById('entry-date');
                this.helpSection = document.getElementById('help-section');
                this.weekNumberInput = document.getElementById('week-number');
                this.dailyTip = document.getElementById('daily-tip-section');

                // Vérification des éléments critiques
                if (!this.calendarContainer || !this.currentMonthYear) {
                    console.error('Éléments critiques manquants dans le DOM');
                    this.showNotification('Erreur: Éléments critiques manquants', 'error');
                    return;
                }

                console.log('DOM initialisé avec succès');
            }

            setupEventListeners() {
                // Navigation du calendrier
                document.getElementById('prevMonth')?.addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('nextMonth')?.addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });

                // Boutons du formulaire
                document.getElementById('cancel-btn')?.addEventListener('click', () => {
                    this.hideEntryForm();
                });

                document.getElementById('close-form')?.addEventListener('click', () => {
                    this.hideEntryForm();
                });

                // Soumission du formulaire
                this.journalForm?.addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.saveEntry();
                });

                // Gestion des onglets
                document.querySelectorAll('.tab-button').forEach(button => {
                    button.addEventListener('click', () => {
                        this.switchTab(button.getAttribute('data-tab'));
                    });
                });

                // Bouton aide
                document.getElementById('help-btn')?.addEventListener('click', () => {
                    this.helpSection.classList.toggle('hidden');
                });

                // Prévisualisation des images
                this.setupImagePreviews();

                // Auto-resize des textareas
                this.setupAutoResize();

                // Gestion des tâches et événements
                this.setupNotesHandlers();

                // Calculatrice de trade
                this.setupTradeCalculator();

                // Calculatrice de risque
                this.setupRiskCalculator();

                // Nouveaux boutons
                document.getElementById('importDataBtn')?.addEventListener('click', () => {
                    document.getElementById('importDataInput').click();
                });
                document.getElementById('importDataInput')?.addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                });
                document.getElementById('exportDataBtn')?.addEventListener('click', () => {
                    this.exportData();
                });
                document.getElementById('clearDataBtn')?.addEventListener('click', () => {
                    this.clearAllData();
                });
            }

            calculatePnl(tradeData) {
                if (!tradeData || !tradeData.result || tradeData.result === 'breakeven') return 0;

                const { asset, positionSize, stopLoss, takeProfit, result } = tradeData;
                if (!asset || !positionSize || !result) return 0;

                const ticker = this.tickerData[asset];
                if (!ticker) return 0;

                const posSize = parseFloat(positionSize);
                // Ensure takeProfit and stopLoss are valid numbers
                const tp = parseFloat(takeProfit);
                const sl = parseFloat(stopLoss);

                let pnl = 0;

                if (result === 'win' && !isNaN(tp)) { // Check if tp is a valid number
                    pnl = posSize * tp * ticker.tickValue;
                } else if (result === 'loss' && !isNaN(sl)) { // Check if sl is a valid number
                    pnl = -1 * posSize * sl * ticker.tickValue;
                }

                return pnl;
            }

            renderCalendar() {
                if (!this.calendarContainer || !this.currentMonthYear) {
                    console.error('Éléments du calendrier manquants');
                    return;
                }

                // Vider le conteneur en ne gardant que les en-têtes
                while (this.calendarContainer.children.length > 8) {
                    this.calendarContainer.removeChild(this.calendarContainer.lastChild);
                }

                const year = this.currentDate.getFullYear();
                const month = this.currentDate.getMonth();

                this.currentMonthYear.textContent = new Date(year, month).toLocaleDateString('fr-FR', {
                    month: 'long',
                    year: 'numeric'
                });

                const firstDayOfMonth = new Date(year, month, 1);
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const startOffset = (firstDayOfMonth.getDay() + 6) % 7; // 0 = Lundi

                let currentWeekPnl = 0;
                let currentWeekDaysTraded = new Set();
                let weekCounter = 1;

                // 1. Jours du mois précédent
                const prevMonthDays = new Date(year, month, 0).getDate();
                for (let i = 0; i < startOffset; i++) {
                    const day = this.createCalendarDay({ day: prevMonthDays - startOffset + 1 + i, isOtherMonth: true });
                    this.calendarContainer.appendChild(day);
                }

                // 2. Jours du mois actuel
                for (let i = 1; i <= daysInMonth; i++) {
                    const dayDate = new Date(year, month, i);
                    const dayOfWeek = (dayDate.getDay() + 6) % 7;

                    // Calcul du PnL pour le jour
                    const formattedDate = this.formatDate(dayDate);
                    const entryDataString = localStorage.getItem(`journal_entry_${formattedDate}`);
                    if (entryDataString) {
                        try {
                            const entryData = JSON.parse(entryDataString);
                            if (entryData.trade && entryData.trade.result) {
                                const pnl = this.calculatePnl(entryData.trade);
                                if (pnl !== 0 || entryData.trade.result === 'breakeven') {
                                    currentWeekPnl += pnl;
                                    currentWeekDaysTraded.add(i);
                                }
                            }
                        } catch (e) { console.error(`Erreur de parsing pour ${formattedDate}`, e); }
                    }

                    const day = this.createDayElement(dayDate);
                    this.calendarContainer.appendChild(day);

                    // Si c'est un dimanche (fin de semaine)
                    if (dayOfWeek === 6) {
                        this.appendWeeklySummaryCard(currentWeekPnl, currentWeekDaysTraded.size, weekCounter);
                        currentWeekPnl = 0;
                        currentWeekDaysTraded.clear();
                        weekCounter++;
                    }
                    // Si c'est le dernier jour du mois (et pas un dimanche)
                    else if (i === daysInMonth) {
                        for (let j = dayOfWeek + 1; j < 7; j++) {
                            this.calendarContainer.appendChild(this.createCalendarDay({ isOtherMonth: true }));
                        }
                        this.appendWeeklySummaryCard(currentWeekPnl, currentWeekDaysTraded.size, weekCounter);
                        weekCounter++;
                    }
                }

                // 3. Remplir le reste de la grille pour avoir 6 semaines complètes
                const totalGridCells = 6 * 8; // 6 semaines * (7 jours + 1 carte)
                const currentCells = this.calendarContainer.children.length;
                const cellsToAdd = totalGridCells - currentCells;

                let nextMonthDay = 1;
                for (let i = 0; i < cellsToAdd; i++) {
                    const cellIndexInRow = (this.calendarContainer.children.length - 8) % 8;
                    if (cellIndexInRow < 7) {
                        this.calendarContainer.appendChild(this.createCalendarDay({ day: nextMonthDay++, isOtherMonth: true }));
                    } else {
                        this.appendWeeklySummaryCard(0, 0, weekCounter, true);
                        weekCounter++;
                    }
                }
                console.log('Calendrier rendu avec succès');
            }

            createDayElement(date) {
                const dayNumber = date.getDate();
                const isToday = this.formatDate(date) === this.formatDate(new Date());
                const day = this.createCalendarDay(dayNumber, false, isToday);

                const formattedDate = this.formatDate(date);
                const entryDataString = localStorage.getItem(`journal_entry_${formattedDate}`);
                if (entryDataString) {
                    try {
                        const entryData = JSON.parse(entryDataString);
                        const indicatorsContainer = document.createElement('div');
                        indicatorsContainer.className = 'indicators-container';

                        // 1. Trade Icon (Top)
                        const tradeResult = entryData?.trade?.result;
                        const tradeIndicator = document.createElement('span');
                        tradeIndicator.className = 'indicator trade-indicator';
                        if (tradeResult === 'win') {
                            tradeIndicator.textContent = '✅';
                            indicatorsContainer.appendChild(tradeIndicator);
                        } else if (tradeResult === 'loss') {
                            tradeIndicator.textContent = '❌';
                            indicatorsContainer.appendChild(tradeIndicator);
                        }

                        // 2. Daily Icon (Middle)
                        const dailyData = entryData?.daily;
                        const hasDailyEntry = dailyData && Object.values(dailyData).some(value => value !== '');
                        if (hasDailyEntry) {
                            const dailyIndicator = document.createElement('i');
                            dailyIndicator.className = 'fas fa-calendar-week indicator daily-indicator';
                            indicatorsContainer.appendChild(dailyIndicator);
                        }

                        // 3. Note Icon (Bottom)
                        const hasNoteEntry = (entryData?.notes?.general && entryData.notes.general.trim() !== '') ||
                            (entryData?.notes?.todoList && entryData.notes.todoList.length > 0) ||
                            (entryData?.notes?.eventList && entryData.notes.eventList.length > 0);

                        if (entryData?.notes?.eventList && entryData.notes.eventList.length > 0) {
                            console.log(`[ICON] Date: ${formattedDate}, hasEvent: true, eventList:`, entryData.notes.eventList);
                        }

                        if (hasNoteEntry) {
                            const noteIndicator = document.createElement('i');
                            noteIndicator.className = 'fas fa-sticky-note indicator note-indicator';
                            indicatorsContainer.appendChild(noteIndicator);
                        }

                        if (indicatorsContainer.hasChildNodes()) {
                            day.appendChild(indicatorsContainer);
                        }
                    } catch (e) {
                        console.error(`Failed to parse entry for ${formattedDate}`, e);
                    }
                }

                day.addEventListener('click', () => {
                    this.selectedDateForEntry = date;
                    this.showEntryForm(date);
                });

                return day;
            }

            appendWeeklySummaryCard(pnl, daysCount, weekNumber, isEmpty = false) {
                const card = document.createElement('div');
                const weekNum = this.getWeekNumber(new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), (weekNumber * 7) - 6));


                if (isEmpty || daysCount === 0) {
                    card.className = 'weekly-summary-card opacity-50';
                    card.innerHTML = `<p class="week-title">Week ${weekNumber} / <span class="text-accent-blue">${weekNum}</span></p><p class="week-pnl neutral-color">$0,00</p><p class="week-days">0 days</p>`;
                } else {
                    let pnlClass = 'neutral-color';
                    if (pnl > 0) pnlClass = 'profit-color';
                    else if (pnl < 0) pnlClass = 'loss-color';
                    const pnlText = `${pnl >= 0 ? '+' : ''}${pnl.toFixed(2).replace('.', ',')}`;

                    card.className = 'weekly-summary-card';
                    card.innerHTML = `
                        <p class="week-title">Week ${weekNumber} / <span class="text-accent-blue">${weekNum}</span></p>
                        <p class="week-pnl ${pnlClass}">${pnlText}</p>
                        <p class="week-days">${daysCount} day${daysCount > 1 ? 's' : ''}</p>
                    `;
                }
                this.calendarContainer.appendChild(card);
            }

            createCalendarDay(dayNumber, isOtherMonth = false, isToday = false) {
                const day = document.createElement('div');
                day.className = 'calendar-day text-center p-3 bg-bg-dark rounded-lg cursor-pointer transition-all duration-200';

                if (dayNumber > 0) {
                    day.textContent = dayNumber;
                }

                if (isOtherMonth) {
                    day.classList.add('opacity-50', 'other-month');
                }

                if (isToday) {
                    day.classList.add('border-2', 'border-accent-blue', 'font-semibold');
                }

                if (!isOtherMonth) {
                    day.addEventListener('mouseenter', () => {
                        day.style.transform = 'translateY(-2px)';
                        day.style.boxShadow = '0 4px 6px rgba(255, 87, 34, 0.2)';
                    });

                    day.addEventListener('mouseleave', () => {
                        day.style.transform = 'translateY(0)';
                        day.style.boxShadow = 'none';
                    });
                }

                return day;
            }

            formatDate(date) {
                const year = date.getFullYear();
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            getWeekNumber(date) {
                const target = new Date(date.valueOf());
                const dayNr = (date.getDay() + 6) % 7;
                target.setDate(target.getDate() - dayNr + 3);
                const firstThursday = target.valueOf();
                target.setMonth(0, 1);
                if (target.getDay() !== 4) {
                    target.setMonth(0, 1 + ((4 - target.getDay()) + 7) % 7);
                }
                return 1 + Math.ceil((firstThursday - target) / 604800000);
            }

            showEntryForm(date) {
                this.entryDateEl.textContent = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                // Mettre à jour le numéro de semaine
                if (this.weekNumberInput) {
                    this.weekNumberInput.value = this.getWeekNumber(date);
                }

                this.formSection.classList.remove('hidden');
                this.formSection.scrollIntoView({ behavior: 'smooth', block: 'center' });

                // Masquer le conseil du jour
                if (this.dailyTip) {
                    this.dailyTip.classList.add('hidden');
                }

                // Charger les données existantes
                this.loadEntryData(date);
            }

            hideEntryForm() {
                this.formSection.classList.add('hidden');

                // Afficher le conseil du jour
                if (this.dailyTip) {
                    this.dailyTip.classList.remove('hidden');
                }
            }

            switchTab(tabId) {
                // Désactiver tous les boutons et masquer tous les contenus
                document.querySelectorAll('.tab-button').forEach(btn => {
                    btn.classList.remove('bg-accent-blue', 'text-white');
                    btn.classList.add('bg-bg-dark');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.add('hidden');
                    content.classList.remove('block');
                });

                // Activer le bouton et le contenu sélectionnés
                const activeButton = document.querySelector(`[data-tab="${tabId}"]`);
                const activeContent = document.getElementById(`${tabId}-tab`);

                if (activeButton && activeContent) {
                    activeButton.classList.remove('bg-bg-dark');
                    activeButton.classList.add('bg-accent-blue', 'text-white');
                    activeContent.classList.remove('hidden');
                    activeContent.classList.add('block');

                    // Initialiser l'application de l'onglet "Consistency" si c'est la première fois
                    if (tabId === 'consistency' && !window.consistencyAppInstance) {
                        if (typeof Chart !== 'undefined') {
                            window.consistencyAppInstance = new ConsistencyApp();
                        } else {
                            console.error('Chart.js n\'a pas pu être chargé, l\'onglet Consistency ne peut pas être initialisé.');
                            const consistencyTab = document.getElementById('consistency-tab');
                            if (consistencyTab) consistencyTab.innerHTML = '<p class="text-center text-accent-red">La librairie Chart.js n\'a pas pu être chargée. Le suivi de la consistance est indisponible.</p>';
                        }
                    }

                    if (tabId === 'cal-eco') {
                        const tabContent = document.getElementById('cal-eco-tab');
                        if (tabContent && !tabContent.dataset.initialized) {
                            processAndDisplayEconomicCalendarData(economicCalendarJsonData);
                            setEconomicCalendarWeekDates();
                            tabContent.dataset.initialized = 'true';
                        }
                    }
                }
            }

            saveEntry() {
                if (!this.selectedDateForEntry) {
                    this.showNotification('Aucune date sélectionnée', 'error');
                    return;
                }

                const formattedDate = this.formatDate(this.selectedDateForEntry);
                const formData = this.collectFormData();

                console.log(`[SAVE] Saving data for ${formattedDate}:`, JSON.parse(JSON.stringify(formData)));

                // Sauvegarder dans le localStorage
                localStorage.setItem(`journal_entry_${formattedDate}`, JSON.stringify(formData));

                // Ajouter à la liste des dates avec entrées
                let datesWithEntries = this.getDatesWithEntries();
                if (!datesWithEntries.includes(formattedDate)) {
                    datesWithEntries.push(formattedDate);
                    localStorage.setItem('journal_dates_with_entries', JSON.stringify(datesWithEntries));
                }

                this.showNotification('Entrée sauvegardée avec succès!', 'success');
                this.renderCalendar();
            }

            collectFormData() {
                const data = {
                    daily: {},
                    trade: {},
                    weekly: {},
                    notes: {
                        general: '',
                        todoList: [],
                        eventList: []
                    },
                    calculator: {}
                };

                // Collecter les données de chaque onglet
                try {
                    // Daily Tab
                    const dailyTab = document.getElementById('daily-tab');
                    if (dailyTab) {
                        data.daily = {
                            pdr: document.getElementById('daily-pdr')?.value || '',
                            captureH1: document.getElementById('daily-captureH1')?.value || '',
                            observations: document.getElementById('daily-observations')?.value || '',
                            cycleC1Phase: document.getElementById('daily-cycleC1Phase')?.value || '',
                            cycleC1Capture: document.getElementById('daily-cycleC1Capture')?.value || '',
                            cycleC2Phase: document.getElementById('daily-cycleC2Phase')?.value || '',
                            cycleC2Capture: document.getElementById('daily-cycleC2Capture')?.value || '',
                            setupType: document.getElementById('daily-setupType')?.value || '',
                            manipulation: document.getElementById('daily-manipulation')?.value || '',
                            swingPointSwept: document.getElementById('daily-swingPointSwept')?.value || '',
                            captureSetup: document.getElementById('daily-captureSetup')?.value || ''
                        };
                    }

                    // Trade Tab
                    const tradeTab = document.getElementById('trade-tab');
                    if (tradeTab) {
                        data.trade = {
                            asset: document.getElementById('asset-select')?.value || '',
                            positionSize: parseFloat(document.getElementById('position-size')?.value) || 0,
                            stopLoss: parseFloat(document.getElementById('stop-loss')?.value) || 0,
                            takeProfit: parseFloat(document.getElementById('take-profit')?.value) || 0,
                            result: document.getElementById('result-select')?.value || '',
                            pnl: document.getElementById('pnl-result')?.value || '',
                            riskReward: document.getElementById('rr-result')?.value || '',
                            review: tradeTab.querySelector('textarea')?.value || ''
                        };
                    }

                    // Weekly Tab
                    const weeklyTab = document.getElementById('weekly-tab');
                    if (weeklyTab) {
                        data.weekly = {
                            pwr: weeklyTab.querySelector('select')?.value || '',
                            weekNumber: document.getElementById('week-number')?.value || '',
                            captureH4: document.getElementById('weekly-captureH4')?.value || '',
                            observations: weeklyTab.querySelector('textarea')?.value || ''
                        };
                    }

                    // Notes Tab
                    const notesTab = document.getElementById('notes-tab');
                    if (notesTab) {
                        data.notes.general = notesTab.querySelector('textarea')?.value || '';

                        // Collecter les tâches
                        const todoItems = document.querySelectorAll('#todoList li');
                        todoItems.forEach(item => {
                            const checkbox = item.querySelector('input[type="checkbox"]');
                            const text = item.querySelector('.todo-text')?.textContent || '';
                            const priority = item.querySelector('.todo-priority')?.textContent?.length || 1;
                            data.notes.todoList.push({
                                text: text,
                                priority: priority,
                                completed: checkbox?.checked || false
                            });
                        });

                        // Collecter les événements
                        const eventItems = document.querySelectorAll('#eventList li');
                        eventItems.forEach(item => {
                            const checkbox = item.querySelector('input[type="checkbox"]');
                            const time = item.querySelector('.event-time')?.textContent || '';
                            const description = item.querySelector('.event-desc')?.textContent || '';
                            data.notes.eventList.push({
                                time: time,
                                description: description,
                                completed: checkbox?.checked || false
                            });
                        });
                    }

                    // Calculator Tab
                    const calculatorTab = document.getElementById('calculator-tab');
                    if (calculatorTab) {
                        data.calculator = {
                            capital: document.getElementById('calc-capital')?.value || '',
                            risk: document.getElementById('calc-risk')?.value || '',
                            stopLoss: document.getElementById('calc-sl')?.value || '',
                            takeProfit: document.getElementById('calc-tp')?.value || '',
                            selectedTicker: this.selectedTicker
                        };
                    }

                } catch (error) {
                    console.error('Erreur lors de la collecte des données:', error);
                    this.showNotification('Erreur lors de la sauvegarde', 'error');
                }

                return data;
            }

            loadEntryData(date) {
                // Toujours réinitialiser le formulaire avant de charger de nouvelles données
                this.journalForm.reset();
                document.getElementById('todoList').innerHTML = '';
                document.getElementById('eventList').innerHTML = '';
                document.querySelectorAll('.image-preview').forEach(preview => {
                    preview.classList.add('hidden');
                    const img = preview.querySelector('img');
                    if (img) img.src = '';
                });

                const formattedDate = this.formatDate(date);
                const savedData = localStorage.getItem(`journal_entry_${formattedDate}`);

                console.log(`[LOAD] Checking for data for ${formattedDate}. Found:`, !!savedData);

                if (savedData) {
                    try {
                        const data = JSON.parse(savedData);
                        this.populateFormData(data);
                    } catch (error) {
                        console.error('Erreur lors du chargement des données:', error);
                        this.showNotification('Erreur lors du chargement des données', 'error');
                    }
                }
                // La clause 'else' n'est plus nécessaire car le formulaire est déjà vidé.
            }

            populateFormData(data) {
                if (!data) return;

                try {
                    console.log('[LOAD] Populating form with data:', JSON.parse(JSON.stringify(data)));
                    // La réinitialisation se fait maintenant dans loadEntryData

                    // Peupler les données Daily
                    if (data.daily) {
                        document.getElementById('daily-pdr').value = data.daily.pdr || '';
                        document.getElementById('daily-captureH1').value = data.daily.captureH1 || '';
                        document.getElementById('daily-observations').value = data.daily.observations || '';
                        document.getElementById('daily-cycleC1Phase').value = data.daily.cycleC1Phase || '';
                        document.getElementById('daily-cycleC1Capture').value = data.daily.cycleC1Capture || '';
                        document.getElementById('daily-cycleC2Phase').value = data.daily.cycleC2Phase || '';
                        document.getElementById('daily-cycleC2Capture').value = data.daily.cycleC2Capture || '';
                        document.getElementById('daily-setupType').value = data.daily.setupType || '';
                        document.getElementById('daily-manipulation').value = data.daily.manipulation || '';
                        document.getElementById('daily-swingPointSwept').value = data.daily.swingPointSwept || '';
                        document.getElementById('daily-captureSetup').value = data.daily.captureSetup || '';
                    }

                    // Peupler les données Trade
                    if (data.trade) {
                        const elements = {
                            assetSelect: document.getElementById('asset-select'),
                            positionSize: document.getElementById('position-size'),
                            stopLoss: document.getElementById('stop-loss'),
                            takeProfit: document.getElementById('take-profit'),
                            resultSelect: document.getElementById('result-select'),
                            pnlResult: document.getElementById('pnl-result'),
                            rrResult: document.getElementById('rr-result'),
                            review: document.querySelector('#trade-tab textarea')
                        };

                        Object.entries(elements).forEach(([key, element]) => {
                            if (element && data.trade[key]) {
                                element.value = data.trade[key];
                            }
                        });
                    }

                    // Peupler les données Weekly
                    if (data.weekly) {
                        const weeklyTab = document.getElementById('weekly-tab');
                        if (weeklyTab) {
                            const select = weeklyTab.querySelector('select');
                            const urlInput = document.getElementById('weekly-captureH4');
                            const textarea = weeklyTab.querySelector('textarea');
                            const weekNumber = document.getElementById('week-number');

                            if (select) select.value = data.weekly.pwr || '';
                            if (weekNumber) weekNumber.value = data.weekly.weekNumber || '';
                            if (urlInput) urlInput.value = data.weekly.captureH4 || '';
                            if (textarea) textarea.value = data.weekly.observations || '';
                        }
                    }

                    // Peupler les données Notes
                    if (data.notes) {
                        const notesTextarea = document.querySelector('#notes-tab textarea');
                        if (notesTextarea) {
                            notesTextarea.value = data.notes.general || '';
                        }

                        // Recréer les tâches
                        if (data.notes.todoList && data.notes.todoList.length > 0) {
                            data.notes.todoList.forEach(todo => {
                                this.addTodoItem(todo.text, todo.priority, todo.completed);
                            });
                        }

                        // Recréer les événements
                        if (data.notes.eventList && data.notes.eventList.length > 0) {
                            data.notes.eventList.forEach(event => {
                                this.addEventItem(event.time, event.description, event.completed);
                            });
                        }
                    }

                    // Peupler les données Calculator
                    if (data.calculator) {
                        const calcElements = {
                            capital: document.getElementById('calc-capital'),
                            risk: document.getElementById('calc-risk'),
                            stopLoss: document.getElementById('calc-sl'),
                            takeProfit: document.getElementById('calc-tp')
                        };

                        Object.entries(calcElements).forEach(([key, element]) => {
                            if (element && data.calculator[key]) {
                                element.value = data.calculator[key];
                            }
                        });

                        if (data.calculator.selectedTicker) {
                            this.selectedTicker = data.calculator.selectedTicker;
                        }
                    }

                    // Déclencher les prévisualisations d'images
                    document.querySelectorAll('.image-url-input').forEach(input => {
                        if (input.value) {
                            const event = new Event('input');
                            input.dispatchEvent(event);
                        }
                    });

                } catch (error) {
                    console.error('Erreur lors du peuplement des données:', error);
                    this.showNotification('Erreur lors du chargement des données', 'error');
                }
            }

            getDatesWithEntries() {
                try {
                    return JSON.parse(localStorage.getItem('journal_dates_with_entries') || '[]');
                } catch (error) {
                    console.error('Erreur lors du chargement des dates:', error);
                    return [];
                }
            }

            setupImagePreviews() {
                document.querySelectorAll('.image-url-input').forEach(input => {
                    const previewContainer = input.nextElementSibling;
                    if (previewContainer && previewContainer.classList.contains('image-preview')) {
                        input.addEventListener('input', () => {
                            // Vider le conteneur d'aperçus
                            previewContainer.innerHTML = '';

                            // Séparer les URLs par virgule, espace ou nouvelle ligne et limiter à 2
                            let urls = input.value.split(/[\s,]+/).filter(url => url.startsWith('http'));
                            urls = urls.slice(0, 2);

                            if (urls.length > 0) {
                                previewContainer.classList.remove('hidden');
                                urls.forEach(url => {
                                    const a = document.createElement('a');
                                    a.href = url;
                                    a.target = '_blank';
                                    a.rel = 'noopener noreferrer';

                                    const img = document.createElement('img');
                                    img.src = url;
                                    img.alt = "Aperçu de " + url;
                                    img.onerror = () => {
                                        // Optionnel: gérer les erreurs de chargement d'image
                                        a.style.display = 'none';
                                    };

                                    a.appendChild(img);
                                    previewContainer.appendChild(a);
                                });
                            } else {
                                previewContainer.classList.add('hidden');
                            }
                        });
                    }
                });
            }

            setupAutoResize() {
                document.querySelectorAll('.auto-resize').forEach(textarea => {
                    textarea.addEventListener('input', function () {
                        this.style.height = 'auto';
                        this.style.height = (this.scrollHeight) + 'px';
                    });
                });
            }

            setupNotesHandlers() {
                // Gestion des tâches
                const todoInput = document.getElementById('todo-input');
                const todoPriority = document.getElementById('todo-priority');
                const addTodoBtn = document.getElementById('add-todo');

                const addTodo = () => {
                    const text = todoInput.value.trim();
                    const priority = parseInt(todoPriority.value);

                    if (text) {
                        this.addTodoItem(text, priority, false);
                        todoInput.value = '';
                        todoPriority.value = '1';
                    }
                };

                addTodoBtn?.addEventListener('click', addTodo);
                todoInput?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addTodo();
                    }
                });

                // Gestion des événements
                const eventTime = document.getElementById('event-time');
                const eventDesc = document.getElementById('event-desc');
                const addEventBtn = document.getElementById('add-event');

                const addEvent = () => {
                    const time = eventTime.value;
                    const description = eventDesc.value.trim();

                    if (time && description) {
                        this.addEventItem(time, description, false);
                        eventTime.value = '';
                        eventDesc.value = '';
                    }
                };

                addEventBtn?.addEventListener('click', addEvent);
                eventDesc?.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        addEvent();
                    }
                });
            }

            addTodoItem(text, priority, completed = false) {
                const todoList = document.getElementById('todoList');
                const li = document.createElement('li');
                li.className = 'todo-item';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completed;
                checkbox.className = 'form-checkbox h-5 w-5 text-accent-blue';

                const prioritySpan = document.createElement('span');
                prioritySpan.className = 'todo-priority text-lg';
                prioritySpan.textContent = '⭐'.repeat(priority);

                const textSpan = document.createElement('span');
                textSpan.className = 'todo-text flex-1';
                textSpan.textContent = text;

                if (completed) {
                    textSpan.classList.add('line-through', 'text-text-secondary');
                } else {
                    textSpan.classList.remove('line-through', 'text-text-secondary');
                }

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-accent-red hover:bg-accent-red hover:text-white p-1 rounded';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => {
                    li.remove();
                });

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        textSpan.classList.add('line-through', 'text-text-secondary');
                    } else {
                        textSpan.classList.remove('line-through', 'text-text-secondary');
                    }
                });

                li.appendChild(checkbox);
                li.appendChild(prioritySpan);
                li.appendChild(textSpan);
                li.appendChild(deleteBtn);

                todoList.appendChild(li);
            }

            addEventItem(time, description, completed = false) {
                const eventList = document.getElementById('eventList');
                const li = document.createElement('li');
                li.className = 'event-item';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = completed;
                checkbox.className = 'form-checkbox h-5 w-5 text-accent-blue';

                const timeSpan = document.createElement('span');
                timeSpan.className = 'event-time font-bold text-accent-blue';
                timeSpan.textContent = time;

                const descSpan = document.createElement('span');
                descSpan.className = 'event-desc flex-1';
                descSpan.textContent = description;

                if (completed) {
                    descSpan.classList.add('line-through', 'text-text-secondary');
                }

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'text-accent-red hover:bg-accent-red hover:text-white p-1 rounded';
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.addEventListener('click', () => {
                    li.remove();
                });

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        descSpan.classList.add('line-through', 'text-text-secondary');
                    } else {
                        descSpan.classList.remove('line-through', 'text-text-secondary');
                    }
                });

                li.appendChild(checkbox);
                li.appendChild(timeSpan);
                li.appendChild(descSpan);
                li.appendChild(deleteBtn);

                eventList.appendChild(li);
            }

            setupTradeCalculator() {
                const assetSelect = document.getElementById('asset-select');
                const tickValueInput = document.getElementById('tick-value');
                const positionInput = document.getElementById('position-size');
                const stopLossInput = document.getElementById('stop-loss');
                const takeProfitInput = document.getElementById('take-profit');
                const pnlInput = document.getElementById('pnl-result');
                const rrInput = document.getElementById('rr-result');
                const resultSelect = document.getElementById('result-select');

                const calculatePnL = () => {
                    const selectedAsset = assetSelect.value;
                    const position = parseFloat(positionInput.value) || 0;
                    const stopLoss = parseFloat(stopLossInput.value) || 0;
                    const takeProfit = parseFloat(takeProfitInput.value) || 0;
                    const result = resultSelect.value;

                    pnlInput.classList.remove('text-accent-green', 'text-accent-red', 'font-bold');
                    pnlInput.value = ''; // Clear previous value

                    if (result === 'breakeven') {
                        pnlInput.value = '0.00';
                        return;
                    }

                    if (selectedAsset && this.tickerData[selectedAsset] && position > 0) {
                        const tickValue = this.tickerData[selectedAsset].tickValue;

                        if (result === 'win' && takeProfit > 0) {
                            const tpPnL = (takeProfit * tickValue * position).toFixed(2);
                            pnlInput.value = `TP: ${tpPnL}`;
                            pnlInput.classList.add('text-accent-green', 'font-bold');
                        } else if (result === 'loss' && stopLoss > 0) {
                            const slPnL = (-stopLoss * tickValue * position).toFixed(2);
                            pnlInput.value = `SL: ${slPnL}`;
                            pnlInput.classList.add('text-accent-red', 'font-bold');
                        } else {
                            // Default display when no result is selected or inputs are missing
                            const tpPnL = (takeProfit * tickValue * position).toFixed(2);
                            const slPnL = (-stopLoss * tickValue * position).toFixed(2);
                            pnlInput.value = `TP: ${tpPnL} | SL: ${slPnL}`;
                        }
                    }
                };

                const calculateRR = () => {
                    const stopLoss = parseFloat(stopLossInput.value) || 0;
                    const takeProfit = parseFloat(takeProfitInput.value) || 0;

                    if (stopLoss > 0 && takeProfit > 0) {
                        const ratio = (takeProfit / stopLoss).toFixed(2);
                        rrInput.value = `1:${ratio}`;
                    } else {
                        rrInput.value = '';
                    }
                };

                const updateTickValue = () => {
                    const selectedAsset = assetSelect.value;
                    if (selectedAsset && this.tickerData[selectedAsset]) {
                        tickValueInput.value = `${this.tickerData[selectedAsset].tickValue}`;
                    } else {
                        tickValueInput.value = '';
                    }
                    calculatePnL();
                    calculateRR();
                };

                // Event listeners
                assetSelect?.addEventListener('change', updateTickValue);
                resultSelect?.addEventListener('change', calculatePnL); // Specific listener for select
                [positionInput, stopLossInput, takeProfitInput].forEach(input => {
                    input?.addEventListener('input', () => {
                        calculatePnL();
                        calculateRR();
                    });
                });
            }

            setupRiskCalculator() {
                const tickerButtons = document.querySelectorAll('.ticker-btn');
                const calculateBtn = document.getElementById('calculate-btn');
                const results = document.getElementById('calc-results');
                const slLabel = document.getElementById('calc-sl-label');
                const tpLabel = document.getElementById('calc-tp-label');

                const updateSlTpLabels = () => {
                    if (this.selectedTicker === 'GU') {
                        slLabel.textContent = 'Stop Loss (pips)';
                        tpLabel.textContent = 'Take Profit (pips)';
                    } else {
                        slLabel.textContent = 'Stop Loss (ticks)';
                        tpLabel.textContent = 'Take Profit (ticks)';
                    }
                };

                // Sélection du ticker
                tickerButtons.forEach(btn => {
                    btn.addEventListener('click', () => {
                        const isAlreadyActive = btn.classList.contains('btn-primary');

                        // Reset all buttons to secondary style
                        tickerButtons.forEach(b => {
                            b.classList.add('btn-secondary');
                            b.classList.remove('btn-primary');
                        });

                        if (isAlreadyActive) {
                            // If it was already active, just deactivate it and clear selection
                            this.selectedTicker = null;
                        } else {
                            // If it was not active, activate it
                            btn.classList.remove('btn-secondary');
                            btn.classList.add('btn-primary');
                            this.selectedTicker = btn.dataset.ticker;
                        }

                        updateSlTpLabels(); // Update labels when ticker changes
                    });
                });

                // Calcul
                calculateBtn?.addEventListener('click', () => {
                    this.calculateRisk();
                });

                // Activer le bouton du ticker par défaut au chargement et mettre à jour les labels
                const defaultTickerBtn = document.querySelector(`.ticker-btn[data-ticker="${this.selectedTicker}"]`);
                if (defaultTickerBtn) {
                    defaultTickerBtn.classList.remove('btn-secondary');
                    defaultTickerBtn.classList.add('btn-primary');
                }
                updateSlTpLabels(); // Initial label update
            }

            calculateRisk() {
                const capital = parseFloat(document.getElementById('calc-capital').value) || 0;
                const riskPercent = parseFloat(document.getElementById('calc-risk').value) || 0;
                const stopLossTicks = parseFloat(document.getElementById('calc-sl').value) || 0;
                const takeProfitTicks = parseFloat(document.getElementById('calc-tp').value) || 0;

                if (capital <= 0 || riskPercent <= 0 || stopLossTicks <= 0 || takeProfitTicks <= 0) {
                    this.showNotification('Veuillez remplir tous les champs', 'error');
                    return;
                }

                const tickerInfo = this.tickerData[this.selectedTicker];
                if (!tickerInfo) {
                    this.showNotification('Ticker non valide', 'error');
                    return;
                }

                const riskAmount = capital * (riskPercent / 100);
                const riskPerContract = stopLossTicks * tickerInfo.tickValue;
                const maxContracts = Math.floor(riskAmount / riskPerContract);
                const potentialGain = takeProfitTicks * tickerInfo.tickValue * maxContracts;
                const riskReward = takeProfitTicks / stopLossTicks;

                const tickerUnit = (this.selectedTicker === 'GU') ? 'pip' : 'tick';
                const pointUnit = (this.selectedTicker === 'GU') ? 'pips' : 'point';

                // Afficher les résultats
                document.getElementById('selected-ticker').textContent = this.selectedTicker;
                document.getElementById('rr-display').textContent = `1:${riskReward.toFixed(2)}`;
                document.getElementById('risk-display').textContent = `${riskAmount.toFixed(2)}`;
                document.getElementById('gain-display').textContent = `${potentialGain.toFixed(2)}`;
                document.getElementById('contracts-display').textContent = maxContracts;
                document.getElementById('ticker-info').textContent =
                    `${this.selectedTicker}: ${tickerInfo.tickValue} par ${tickerUnit} (${tickerInfo.tickSize} ${pointUnit})`;

                document.getElementById('calc-results').classList.remove('hidden');
                this.showNotification('Calcul terminé avec succès', 'success');
            }

            showNotification(message, type = 'success') {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.textContent = message;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }

            importData(file) {
                if (!file) {
                    this.showNotification('Aucun fichier sélectionné.', 'error');
                    return;
                }

                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        const data = JSON.parse(event.target.result);
                        // Restaurer les données dans localStorage
                        for (const key in data) {
                            localStorage.setItem(key, JSON.stringify(data[key]));
                        }
                        this.showNotification('Données importées avec succès!', 'success');
                        // Recharger l'application pour refléter les changements
                        window.location.reload();
                    } catch (e) {
                        console.error('Erreur lors de l\'importation des données:', e);
                        this.showNotification('Fichier JSON invalide.', 'error');
                    }
                };
                reader.readAsText(file);
            }

            exportData() {
                const dataToExport = {};
                // Collecter toutes les entrées de journal
                const datesWithEntries = this.getDatesWithEntries();
                datesWithEntries.forEach(date => {
                    const entry = localStorage.getItem(`journal_entry_${date}`);
                    if (entry) {
                        dataToExport[`journal_entry_${date}`] = JSON.parse(entry);
                    }
                });
                // Collecter les dates avec entrées
                dataToExport['journal_dates_with_entries'] = datesWithEntries;

                const blob = new Blob([JSON.stringify(dataToExport, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const now = new Date();
                const day = String(now.getDate()).padStart(2, '0');
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const year = String(now.getFullYear()).slice(-2);
                const formattedDate = `${day}.${month}.${year}`;

                const a = document.createElement('a');
                a.href = url;
                a.download = `journal_data_${formattedDate}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                this.showNotification('Données exportées avec succès!', 'success');
            }

            clearAllData() {
                if (confirm('Êtes-vous sûr de vouloir effacer TOUTES les données du journal ? Cette action est irréversible.')) {
                    // Effacer toutes les entrées de journal
                    const datesWithEntries = this.getDatesWithEntries();
                    datesWithEntries.forEach(date => {
                        localStorage.removeItem(`journal_entry_${date}`);
                    });
                    // Effacer la liste des dates avec entrées
                    localStorage.removeItem('journal_dates_with_entries');

                    this.showNotification('Toutes les données ont été effacées.', 'success');
                    // Recharger l'application pour refléter les changements
                    window.location.reload();
                }
            }
        }

        // Initialiser l'application quand le DOM est chargé
        document.addEventListener('DOMContentLoaded', () => {
            try {
                window.tradingJournalApp = new TradingJournal();
                console.log('Application Journal de Trading initialisée avec succès');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation de l\'application:', error);

                // Afficher une notification d'erreur
                const errorDiv = document.createElement('div');
                errorDiv.className = 'notification error';
                errorDiv.textContent = 'Erreur lors du chargement de l\'application';
                document.body.appendChild(errorDiv);

                setTimeout(() => {
                    errorDiv.remove();
                }, 5000);
            }
        });
    </script>
</body>

</html>
